<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tour The Lakes – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="images/TTLFAVIcon.png" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #2b2b2b;
    }

    .site-header {
      width: 100%;
      border-bottom: 1px solid #b86b2a;
    }

    .header-inner {
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 16px;
    }

    .brand {
      color: rgba(255,255,255,0.92);
      font: 600 16px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing: 0.2px;
    }

    *, *::before, *::after { box-sizing: border-box; }

    .admin-wrap { padding: 0 5%; }

    .admin-section-title {
      color: rgba(255,255,255,0.92);
      font: 400 28px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      text-align: center;
      margin: 30px 0;
    }

    .admin-stack {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .admin-field {
      width: 100%;
      border: 1px solid #b86b2a;
      background: #2b2b2b;
      color: rgba(255,255,255,0.92);
      padding: 12px;
      font: 400 16px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .admin-textarea { resize: vertical; }

    .admin-check {
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255,255,255,0.92);
      font: 400 16px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .admin-btn {
      width: 100%;
      border: 1px solid #b86b2a;
      background: #2b2b2b;
      color: #b86b2a;
      padding: 12px;
      cursor: pointer;
      font: 400 16px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .admin-msg {
      color: rgba(255,255,255,0.6);
      font: 400 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .admin-subtitle {
      margin: 30px 0 12px 0;
      color: rgba(255,255,255,0.92);
      font: 400 20px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .admin-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 30px;
    }

    .admin-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 30px;
    }

    .admin-calendar-section {
      max-width: 900px;
      margin: 40px auto;
    }

    .admin-schedule-section {
      max-width: 900px;
      margin: 40px auto;
    }

    #scheduleMsg {
      margin-bottom: 16px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-header button {
      border: 1px solid #b86b2a;
      background: #2b2b2b;
      color: #b86b2a;
      padding: 8px 12px;
      cursor: pointer;
      font: 400 14px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .calendar-month {
      color: rgba(255,255,255,0.92);
      font: 600 16px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing: 0.2px;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(6, 1fr);
    }

    .calendar-weekdays div {
      text-align: center;
      font-weight: 600;
      padding: 10px 0;
      color: rgba(255,255,255,0.92);
    }

    .calendar-cell {
      border: 1px solid #444;
      min-height: 56px;
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 6px;
      color: rgba(255,255,255,0.8);
      cursor: pointer;
      user-select: none;
    }

    .calendar-cell.is-empty {
      opacity: 0.25;
      cursor: default;
    }

    .calendar-cell.selected {
      border: 2px solid #b86b2a;
    }

    .calendar-cell.has-data {
      background: rgba(184,107,42,0.15);
    }

    .calendar-cell:not(.is-empty):hover {
      background: rgba(255,255,255,0.05);
    }

    .site-footer {
      width: 100%;
      border-top: 1px solid #b86b2a;
    }

    .footer-inner {
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 16px;
    }

    .footer-text {
      color: rgba(255,255,255,0.6);
      font: 400 16px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing: 0.2px;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="brand">Tour The Lakes</div>
    </div>
  </header>

  <main class="admin-main">
    <div class="admin-wrap">

      <div class="admin-section-title">Create Tour</div>

      <div class="admin-stack">
        <input id="tourTitle" type="text" placeholder="Tour title" class="admin-field" />
        <input id="tourImageFile" type="file" accept="image/*" class="admin-field" />
        <textarea id="tourDescription" rows="6" placeholder="Tour description" class="admin-field admin-textarea"></textarea>

        <label class="admin-check">
          <input id="tourLive" type="checkbox" />
          <span>Live</span>
        </label>

        <button id="saveTour" type="button" class="admin-btn admin-btn-full">SAVE</button>
        <div id="adminMsg" class="admin-msg"></div>
      </div>

      <div class="admin-subtitle">Existing Tours</div>
      <div id="tourList" class="admin-list"></div>

      <div class="admin-actions">
        <button id="amendTour" type="button" class="admin-btn">AMEND</button>
        <button id="deleteTour" type="button" class="admin-btn">DELETE</button>
      </div>

      <!-- Calendar -->
      <div class="admin-calendar-section">
        <div class="calendar-header">
          <button id="calPrev" type="button">◀</button>
          <div id="calMonth" class="calendar-month"></div>
          <button id="calNext" type="button">▶</button>
        </div>

        <div class="calendar-weekdays">
          <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
        </div>

        <div class="calendar-grid" id="calendarGrid"></div>
      </div>

      <!-- Schedule (below calendar) -->
<div class="admin-schedule-section">
  <div class="admin-subtitle">Manage Times & Capacity</div>

  <div class="admin-msg" id="scheduleMsg">
    Select a tour, then click a date in the calendar.
  </div>

  <div class="admin-stack" id="scheduleControls" hidden>
    <input id="selectedDate" class="admin-field" type="text" readonly />

    <input id="tourTime" class="admin-field" type="time" />

    <input id="tourCapacity" class="admin-field" type="number" min="1" placeholder="Capacity" />

    <button id="confirmSchedule" type="button" class="admin-btn">
      CONFIRM
    </button>

    <div id="timesListWrap" class="admin-stack">
  <div class="admin-msg" id="timesListMsg">No date selected.</div>
  <div id="timesList" class="admin-list"></div>
   </div>
    
  </div>
</div>

      
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-text">© Tour The Lakes</div>
    </div>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getDatabase, ref, set, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
      authDomain: "tourthelakes-1e165.firebaseapp.com",
      databaseURL: "https://tourthelakes-1e165-default-rtdb.firebaseio.com",
      projectId: "tourthelakes-1e165",
      storageBucket: "tourthelakes-1e165.firebasestorage.app",
      messagingSenderId: "470758171431",
      appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
      measurementId: "G-W6JY1LZXTP"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    function slugifyTitle(input) {
      return String(input || "")
        .trim()
        .toLowerCase()
        .replace(/['"]/g, "")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "");
    }

    const titleEl = document.getElementById("tourTitle");
    const imgFileEl = document.getElementById("tourImageFile");
    const liveEl = document.getElementById("tourLive");
    const saveBtn = document.getElementById("saveTour");
    const msgEl = document.getElementById("adminMsg");
    const tourListEl = document.getElementById("tourList");
    const amendBtn = document.getElementById("amendTour");
    const deleteBtn = document.getElementById("deleteTour");
    const descEl = document.getElementById("tourDescription");

    // ===== Schedule state =====
    let selectedDateKey = "";
    const selectedDateEl = document.getElementById("selectedDate");
    const scheduleMsgEl = document.getElementById("scheduleMsg");
    const scheduleControlsEl = document.getElementById("scheduleControls");
    const tourTimeEl = document.getElementById("tourTime");
    const tourCapacityEl = document.getElementById("tourCapacity");
    const confirmScheduleBtn = document.getElementById("confirmSchedule");
    const timesListMsgEl = document.getElementById("timesListMsg");
    const timesListEl = document.getElementById("timesList");

    // listener cleanup for currently selected date's times
    let unsubscribeTimes = null;

    function hardRefresh() {
      window.location.reload();
    }

    let selectedTourId = "";
    let selectedTourData = null;

    // ===== Calendar state =====
    const calPrevBtn = document.getElementById("calPrev");
    const calNextBtn = document.getElementById("calNext");
    const calMonthEl = document.getElementById("calMonth");
    const calendarGrid = document.getElementById("calendarGrid");
    const CELL_COUNT = 42;

    // which month are we looking at?
    let viewYear = new Date().getFullYear();
    let viewMonth = new Date().getMonth(); // 0-11

    // Dates saved in Firebase for the currently selected tour (YYYY-MM-DD keys)
    let savedDates = new Set();

    // unsubscribe function for /tours/{id}/dates listener
    let unsubscribeDates = null;

    function pad2(n) { return String(n).padStart(2, "0"); }

    function toKeyYYYYMMDD(y, m0, d) {
      // m0 is 0-based month
      return `${y}-${pad2(m0 + 1)}-${pad2(d)}`;
    }

    function monthLabel(y, m0) {
      const dt = new Date(y, m0, 1);
      return dt.toLocaleString(undefined, { month: "long", year: "numeric" });
    }

    function firstDayIndexMonFirst(y, m0) {
      // JS getDay(): Sun=0..Sat=6
      // Convert so Mon=0..Sun=6
      const js = new Date(y, m0, 1).getDay();
      return (js + 6) % 7;
    }

    function daysInMonth(y, m0) {
      return new Date(y, m0 + 1, 0).getDate();
    }

    function ensureGridCells() {
      if (calendarGrid.children.length === CELL_COUNT) return;
      calendarGrid.innerHTML = "";
      for (let i = 0; i < CELL_COUNT; i++) {
        const cell = document.createElement("div");
        cell.className = "calendar-cell is-empty";
        cell.dataset.key = "";   // YYYY-MM-DD (or empty)
        cell.textContent = "";
        calendarGrid.appendChild(cell);
      }
    }

    function renderCalendar() {
      ensureGridCells();

      calMonthEl.textContent = monthLabel(viewYear, viewMonth);

      const startIdx = firstDayIndexMonFirst(viewYear, viewMonth);
      const dim = daysInMonth(viewYear, viewMonth);

      for (let i = 0; i < CELL_COUNT; i++) {
        const cell = calendarGrid.children[i];
        cell.classList.remove("selected", "has-data", "is-empty");
        cell.dataset.key = "";
        cell.textContent = "";
        cell.classList.add("is-empty");

        const dayNum = i - startIdx + 1;
        if (dayNum < 1 || dayNum > dim) {
          // stays empty
          continue;
        }

        const key = toKeyYYYYMMDD(viewYear, viewMonth, dayNum);
        cell.dataset.key = key;
        cell.textContent = String(dayNum);
        cell.classList.remove("is-empty");

        if (savedDates.has(key)) {
          cell.classList.add("has-data");
        }
      }
    }

    function attachDatesListenerForTour(tourId) {
      // clear previous
      if (typeof unsubscribeDates === "function") {
        unsubscribeDates();
        unsubscribeDates = null;
      }
      savedDates = new Set();

      if (!tourId) {
        renderCalendar();
        return;
      }

      const datesRef = ref(db, `tours/${tourId}/dates`);
      unsubscribeDates = onValue(datesRef, (snap) => {
        const val = snap.val();
        savedDates = new Set();
        if (val && typeof val === "object") {
          for (const k of Object.keys(val)) savedDates.add(k);
        }
        renderCalendar();
      });
    }

function clearTimesUI() {
  if (timesListEl) timesListEl.innerHTML = "";
  if (timesListMsgEl) timesListMsgEl.textContent = "No date selected.";
}

function detachTimesListener() {
  if (typeof unsubscribeTimes === "function") {
    unsubscribeTimes();
    unsubscribeTimes = null;
  }
}

function renderTimesList(timesObj) {
  if (!timesListEl) return;

  timesListEl.innerHTML = "";

  if (!timesObj || typeof timesObj !== "object") {
    if (timesListMsgEl) timesListMsgEl.textContent = "No times saved for this date yet.";
    return;
  }

  const times = Object.keys(timesObj).sort(); // "09:30", "14:30", ...

  if (!times.length) {
    if (timesListMsgEl) timesListMsgEl.textContent = "No times saved for this date yet.";
    return;
  }

  if (timesListMsgEl) timesListMsgEl.textContent = `Saved times for ${selectedDateKey}:`;

  for (const time of times) {
    const row = document.createElement("div");
    row.style.border = "1px solid #b86b2a";
    row.style.padding = "10px";
    row.style.background = "#2b2b2b";
    row.style.color = "rgba(255,255,255,0.92)";
    row.style.display = "flex";
    row.style.flexDirection = "column";
    row.style.gap = "8px";

    const cap = timesObj?.[time]?.capacity ?? "";

    // top line
    const top = document.createElement("div");
    top.textContent = `${time} — capacity: ${cap}`;
    row.appendChild(top);

    // edit controls
    const controls = document.createElement("div");
    controls.style.display = "flex";
    controls.style.gap = "8px";

    const capInput = document.createElement("input");
    capInput.type = "number";
    capInput.min = "1";
    capInput.value = String(cap || "");
    capInput.className = "admin-field";
    capInput.style.padding = "10px";
    capInput.style.flex = "1";

    const saveBtn = document.createElement("button");
    saveBtn.type = "button";
    saveBtn.className = "admin-btn";
    saveBtn.textContent = "UPDATE CAPACITY";
    saveBtn.style.flex = "1";

    const delBtn = document.createElement("button");
    delBtn.type = "button";
    delBtn.className = "admin-btn";
    delBtn.textContent = "DELETE TIME";
    delBtn.style.flex = "1";

    saveBtn.addEventListener("click", async () => {
      const newCap = parseInt(capInput.value, 10);
      if (!newCap || newCap < 1) {
        if (timesListMsgEl) timesListMsgEl.textContent = "Enter a valid capacity (>= 1).";
        return;
      }

      try {
        await update(
          ref(db, `tours/${selectedTourId}/dates/${selectedDateKey}/times/${time}`),
          { capacity: newCap }
        );
        if (timesListMsgEl) timesListMsgEl.textContent = `Updated ${time} to capacity ${newCap}.`;
      } catch (err) {
        if (timesListMsgEl) timesListMsgEl.textContent = `Error: ${err?.message || err}`;
      }
    });

    delBtn.addEventListener("click", async () => {
      const ok = confirm(`Delete time ${time} for ${selectedDateKey}?`);
      if (!ok) return;

      try {
        await remove(ref(db, `tours/${selectedTourId}/dates/${selectedDateKey}/times/${time}`));
        if (timesListMsgEl) timesListMsgEl.textContent = `Deleted ${time}.`;
      } catch (err) {
        if (timesListMsgEl) timesListMsgEl.textContent = `Error: ${err?.message || err}`;
      }
    });

    controls.appendChild(capInput);
    controls.appendChild(saveBtn);
    controls.appendChild(delBtn);

    row.appendChild(controls);
    timesListEl.appendChild(row);
  }
}

function attachTimesListenerForSelectedDate() {
  detachTimesListener();

  if (!selectedTourId || !selectedDateKey) {
    clearTimesUI();
    return;
  }

  if (timesListMsgEl) timesListMsgEl.textContent = "Loading times...";

  const timesRef = ref(db, `tours/${selectedTourId}/dates/${selectedDateKey}/times`);
  unsubscribeTimes = onValue(timesRef, (snap) => {
    renderTimesList(snap.val());
  });
}
    
calendarGrid.addEventListener("click", async (e) => {
  const cell = e.target.closest(".calendar-cell");
  if (!cell) return;

  const key = cell.dataset.key;
  if (!key) return; // empty cell

  if (!selectedTourId) {
    msgEl.textContent = "Select a tour first (then pick dates).";
    return;
  }

  // If date doesn't exist yet, create the date node (but never delete on click)
  try {
    if (!savedDates.has(key)) {
      await set(ref(db, `tours/${selectedTourId}/dates/${key}`), true);
    }
  } catch (err) {
    msgEl.textContent = `Error: ${err?.message || err}`;
    return;
  }

  // select date in UI
  selectedDateKey = key;
  if (selectedDateEl) selectedDateEl.value = key;
  if (scheduleControlsEl) scheduleControlsEl.hidden = false;
  if (scheduleMsgEl) scheduleMsgEl.textContent = `Selected date: ${key}`;

  // highlight only the clicked date
  calendarGrid.querySelectorAll(".calendar-cell.selected").forEach((c) => c.classList.remove("selected"));
  cell.classList.add("selected");

  // load times list for this date
  attachTimesListenerForSelectedDate();
});

    calPrevBtn.addEventListener("click", () => {
      viewMonth -= 1;
      if (viewMonth < 0) { viewMonth = 11; viewYear -= 1; }
      renderCalendar();
    });

    calNextBtn.addEventListener("click", () => {
      viewMonth += 1;
      if (viewMonth > 11) { viewMonth = 0; viewYear += 1; }
      renderCalendar();
    });

    // initial calendar paint (no tour selected yet)
    renderCalendar();

    // ===== Tours list + select =====
    onValue(ref(db, "tours"), (snapshot) => {
      const tours = snapshot.val();
      tourListEl.innerHTML = "";
      if (!tours) return;

      for (const [tourId, tour] of Object.entries(tours)) {
        const row = document.createElement("button");
        row.type = "button";
        row.textContent = tour?.title ? tour.title : tourId;
        row.style.padding = "10px";
        row.style.border = "1px solid #b86b2a";
        row.style.background = (tourId === selectedTourId) ? "#1f1f1f" : "#2b2b2b";
        row.style.color = "rgba(255,255,255,0.92)";
        row.style.cursor = "pointer";
        row.style.textAlign = "left";

row.addEventListener("click", () => {
  selectedTourId = tourId;
  selectedTourData = tour || null;

  // reset schedule selection when switching tours
  selectedDateKey = "";
  if (selectedDateEl) selectedDateEl.value = "";
  if (scheduleControlsEl) scheduleControlsEl.hidden = true;
  if (scheduleMsgEl) scheduleMsgEl.textContent = "Select a tour, then click a date in the calendar.";

  // remove selected border on calendar (from previous tour/date)
  calendarGrid.querySelectorAll(".calendar-cell.selected").forEach((c) => c.classList.remove("selected"));

  detachTimesListener();
  clearTimesUI();

  // populate the tour form fields
  titleEl.value = tour?.title || "";
  liveEl.checked = !!tour?.isLive;
  descEl.value = tour?.description || "";

  msgEl.textContent = `Selected: ${tourId}`;

  attachDatesListenerForTour(tourId);
});

        tourListEl.appendChild(row);
      }
    });

    // ===== AMEND =====
    amendBtn.addEventListener("click", async () => {
      if (!selectedTourId) {
        msgEl.textContent = "Select a tour first.";
        return;
      }

      const title = titleEl.value.trim();
      const isLive = !!liveEl.checked;
      const description = descEl.value.trim();

      if (!title) {
        msgEl.textContent = "Title required.";
        return;
      }

      const file = imgFileEl.files && imgFileEl.files[0] ? imgFileEl.files[0] : null;

      try {
        let imageUrl = selectedTourData?.imageUrl || "";

        if (file) {
          const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, "_");
          const stamp = Date.now();
          const path = `tours/${selectedTourId}/images/${stamp}-${safeName}`;

          const storageRef = sRef(storage, path);
          await uploadBytes(storageRef, file);
          imageUrl = await getDownloadURL(storageRef);
        }

        await update(ref(db, `tours/${selectedTourId}`), {
          title,
          imageUrl,
          isLive,
          description,
        });

        msgEl.textContent = `Amended: tours/${selectedTourId}`;
        hardRefresh();
      } catch (err) {
        msgEl.textContent = `Error: ${err?.message || err}`;
      }
    });

    // ===== DELETE =====
    deleteBtn.addEventListener("click", async () => {
      if (!selectedTourId) {
        msgEl.textContent = "Select a tour first.";
        return;
      }

      const ok = confirm(`Delete tour "${selectedTourId}" from database?`);
      if (!ok) return;

      try {
        await remove(ref(db, `tours/${selectedTourId}`));
        msgEl.textContent = `Deleted: tours/${selectedTourId}`;
        hardRefresh();

        selectedTourId = "";
        selectedTourData = null;
        titleEl.value = "";
        liveEl.checked = false;
      } catch (err) {
        msgEl.textContent = `Error: ${err?.message || err}`;
      }
    });

    // ===== SAVE (new tour only) =====
    saveBtn.addEventListener("click", async () => {
      if (selectedTourId) {
        msgEl.textContent = "Use AMEND to update an existing tour.";
        return;
      }

      const title = titleEl.value.trim();
      const isLive = !!liveEl.checked;
      const description = descEl.value.trim();

      if (!title) {
        msgEl.textContent = "Title required.";
        return;
      }

      const tourId = slugifyTitle(title);
      if (!tourId) {
        msgEl.textContent = "Invalid title.";
        return;
      }

      const file = imgFileEl.files && imgFileEl.files[0] ? imgFileEl.files[0] : null;

      let imageUrl = selectedTourData?.imageUrl || "";

      try {
        if (file) {
          const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, "_");
          const stamp = Date.now();
          const path = `tours/${tourId}/images/${stamp}-${safeName}`;

          const storageRef = sRef(storage, path);
          await uploadBytes(storageRef, file);
          imageUrl = await getDownloadURL(storageRef);
        }

        const tourData = { title, imageUrl, isLive, description };
        await update(ref(db, `tours/${tourId}`), tourData);

        msgEl.textContent = `Saved: tours/${tourId}`;
        hardRefresh();
      } catch (err) {
        msgEl.textContent = `Error: ${err?.message || err}`;
      }
    });

    // ===== CONFIRM (add/update time + capacity) =====
confirmScheduleBtn.addEventListener("click", async () => {
  if (!selectedTourId) {
    scheduleMsgEl.textContent = "Select a tour first.";
    return;
  }
  if (!selectedDateKey) {
    scheduleMsgEl.textContent = "Select a date first.";
    return;
  }

  const time = tourTimeEl.value;
  const capacity = parseInt(tourCapacityEl.value, 10);

  if (!time) {
    scheduleMsgEl.textContent = "Select a time.";
    return;
  }
  if (!capacity || capacity < 1) {
    scheduleMsgEl.textContent = "Enter valid capacity.";
    return;
  }

  try {
    await set(
      ref(db, `tours/${selectedTourId}/dates/${selectedDateKey}/times/${time}`),
      { capacity }
    );

    scheduleMsgEl.textContent = `Saved ${time} (${capacity} spaces).`;

    // clear inputs only
    tourTimeEl.value = "";
    tourCapacityEl.value = "";

    // keep selectedDateKey and schedule UI visible
    // times list will update automatically via onValue listener
  } catch (err) {
    scheduleMsgEl.textContent = `Error: ${err?.message || err}`;
  }
});
    void db;
  </script>
</body>
</html>
