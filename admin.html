<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin · Tour The Lakes</title>
  <meta name="robots" content="noindex, nofollow"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0e1116; --smoke:#12171e; --smoke2:#0b0d10;
      --ink:#e8f1f8; --muted:#a8b0bb;
      --neon:#55f0ff; --neon2:#00d2ff;
      --line:#273341; --shadow:0 18px 50px rgba(0,0,0,.35);
      --grad: radial-gradient(70% 80% at 65% 30%, #15212c 0%, #0e141b 55%, #0b0e13 100%);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    h1,h2,h3{font-family:Outfit,Inter,system-ui; letter-spacing:.2px}
    a{color:var(--neon);text-decoration:none}

    /* banner */
    header{position:relative;overflow:hidden;padding:40px 14px;text-align:center}
    header .layer{position:absolute;inset:-25% -10% auto -10%;height:125%;background:var(--grad)}
    .glow{position:absolute;border-radius:50%;filter:blur(40px);opacity:.55}
    .g1{width:420px;height:420px;left:-140px;top:-160px;background:radial-gradient(closest-side, rgba(85,240,255,.28), rgba(85,240,255,0))}
    .g2{width:320px;height:320px;right:-100px;bottom:-140px;background:radial-gradient(closest-side, rgba(0,210,255,.22), rgba(0,210,255,0))}
    header .inner{position:relative;z-index:2;max-width:1100px;margin:0 auto}
    .circle{
      display:inline-flex;align-items:center;justify-content:center;
      width:140px;height:140px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, var(--neon), var(--neon2));
      color:#00242a;font-family:Outfit;font-size:28px;font-weight:800;
      box-shadow:0 0 40px rgba(85,240,255,.4);
      margin-bottom:16px;
    }
    header p{margin:0;color:var(--muted)}
    .logout{position:absolute;top:16px;right:16px}
    .btn{display:inline-block;border:0;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer}
    .ghost{background:transparent;border:1px solid #2a3948;color:#dfeaf3}
    .primary{background:linear-gradient(90deg,var(--neon),var(--neon2));color:#00242a}

    main{max-width:1100px;margin:18px auto 40px;padding:0 14px}

    /* panels */
    .panel{position:relative;padding:18px;border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(19,24,32,.85), rgba(19,24,32,.74));
      border:1px solid var(--line);box-shadow: var(--shadow);backdrop-filter: blur(6px);margin:16px 0;}
    .panel h2{text-align:center;margin:0 0 14px}
    .panel h2::after{content:"";display:block;height:3px;margin:8px auto 0;
      width: clamp(90px, 14vw, 180px);
      background: linear-gradient(90deg, var(--neon), var(--neon2));
      border-radius:2px;}

    label{display:block;font-weight:600;margin:10px 0 6px}
    input, select, textarea{
      width:100%; padding:12px; border-radius:12px;
      border:1px solid #2a3948; background:#0f141b; color:#dfeaf3
    }
    textarea{min-height:120px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:760px){ .row.two{grid-template-columns:1fr 1fr} .row.three{grid-template-columns:1fr 1fr 1fr} }

    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="layer"></div><div class="glow g1"></div><div class="glow g2"></div>
    <div class="inner">
      <div class="circle">Admin</div>
      <p class="muted">Create and manage tours & events<br><span id="who"></span></p>
      <div class="logout"><button class="btn ghost" id="logoutBtn">Log out</button></div>
    </div>
  </header>

  <main>
    <!-- Create / Edit -->
    <section class="panel">
      <h2>Create / Edit</h2>
      <form id="form">
        <input type="hidden" id="editingId">
        <input type="hidden" id="editingCol">
        <div class="row two">
          <div>
            <label for="type">Type</label>
            <select id="type" required>
              <option value="tours">Tour</option>
              <option value="events">Event</option>
            </select>
          </div>
          <div>
            <label for="title">Title</label>
            <input id="title" required placeholder="Windermere & Ambleside Day"/>
          </div>
        </div>
        <div class="row three">
          <div>
            <label for="date">Event date</label>
            <input id="date" type="date" required/>
          </div>
          <div>
            <label for="cutoff">Payment cut-off</label>
            <input id="cutoff" type="date" required/>
          </div>
          <div>
            <label for="price">Price (£)</label>
            <input id="price" type="number" min="0" required/>
          </div>
        </div>
        <div class="row two">
          <div>
            <label for="minNeeded">Min to run</label>
            <input id="minNeeded" type="number" value="20"/>
          </div>
          <div>
            <label for="capacity">Capacity</label>
            <input id="capacity" type="number" placeholder="30"/>
          </div>
        </div>
        <div>
          <label for="description">Description</label>
          <textarea id="description" required></textarea>
        </div>
        <div>
          <label for="paymentInfo">Payment instructions</label>
          <textarea id="paymentInfo" placeholder="Preferred: BACS (no fees). Card accepted (+10% surcharge). Refunds via BACS only."></textarea>
        </div>
        <div>
          <label for="image">Feature image</label>
          <input id="image" type="file" accept="image/*"/>
        </div>
        <div class="actions" style="margin-top:12px">
          <button type="submit" class="btn primary" id="saveBtn">Save</button>
          <button type="button" class="btn ghost" id="cancelBtn" style="display:none">Cancel</button>
        </div>
        <p id="msg" class="muted" style="margin-top:8px"></p>
      </form>
    </section>

    <!-- Listings will render below (same as before) -->
    <section class="panel">
      <h2>Listings</h2>
      <div id="lists"></div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore, collection, addDoc, updateDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
      authDomain: "tourthelakes-1e165.firebaseapp.com",
      projectId: "tourthelakes-1e165",
      storageBucket: "tourthelakes-1e165.firebasestorage.app",
      appId: "1:470758171431:web:f06dd39b0f15b63b2bff02"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const ALLOWED = ["info@tourthelakes.com"];
    const who = document.getElementById("who");
    const logoutBtn = document.getElementById("logoutBtn");

    onAuthStateChanged(auth, user=>{
      if(!user || !ALLOWED.includes(user.email ?? "")){
        alert("Not authorised."); signOut(auth); window.location.href="/"; return;
      }
      who.textContent = `Signed in as ${user.email}`;
    });
    logoutBtn.onclick=()=>signOut(auth).then(()=>location.href="/");

    // form save logic...
    const form=document.getElementById("form");
    form.onsubmit=async e=>{
      e.preventDefault();
      const col=document.getElementById("type").value;
      const data={
        title:document.getElementById("title").value.trim(),
        date:document.getElementById("date").value,
        cutoff:document.getElementById("cutoff").value,
        price:+document.getElementById("price").value,
        minNeeded:+document.getElementById("minNeeded").value||20,
        capacity:+document.getElementById("capacity").value||0,
        description:document.getElementById("description").value.trim(),
        paymentInfo:document.getElementById("paymentInfo").value.trim(),
        createdAt:serverTimestamp()
      };
      const f=document.getElementById("image").files[0];
      if(f){
        const path=`images/${col}/${Date.now()}_${f.name}`;
        const uploadTask=uploadBytesResumable(ref(storage,path),f);
        await new Promise((res,rej)=>{uploadTask.on("state_changed",null,rej,res)});
        data.imageUrl=await getDownloadURL(ref(storage,path));
      }
      await addDoc(collection(db,col),data);
      form.reset();
      document.getElementById("msg").textContent="Saved.";
    };
  </script>
</body>
</html>
