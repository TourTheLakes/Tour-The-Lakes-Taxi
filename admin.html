<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tour The Lakes – Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/TTLFAVIcon.png">

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #2b2b2b;
        }

.site-header {
  width: 100%;
  border-bottom: 1px solid #b86b2a;
}

.header-inner {
  height: 64px;
  display: flex;
  align-items: center;
  padding: 0 16px;
}

.brand {
  color: rgba(255,255,255,0.92);
  font: 600 16px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  letter-spacing: 0.2px;
}



.site-footer {
  width: 100%;
  border-top: 1px solid #b86b2a;
}

.footer-inner {
  height: 64px;
  display: flex;
  align-items: center;
  padding: 0 16px;
}

.footer-text {
  color: rgba(255,255,255,0.6);
  font: 400 16px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  letter-spacing: 0.2px;
}
        
    </style>
</head>
<body>

    <header class="site-header">
  <div class="header-inner">
    <div class="brand">Tour The Lakes</div>
  </div>
</header>

<main style="padding:16px;">
  <div style="max-width:720px;">
    <div style="color:rgba(255,255,255,0.92); font:600 16px/1 system-ui; margin-bottom:12px;">
      Create Tour
    </div>

    <div style="display:flex; flex-direction:column; gap:10px;">
      <input id="tourTitle" type="text" placeholder="Tour title" style="padding:10px; border:1px solid #b86b2a; background:#2b2b2b; color:rgba(255,255,255,0.92);">
      <input id="tourImageFile" type="file" accept="image/*" style="padding:10px; border:1px solid #b86b2a; background:#2b2b2b; color:rgba(255,255,255,0.92);">
        
        <label style="display:flex; gap:8px; align-items:center; color:rgba(255,255,255,0.92);">
        <input id="tourLive" type="checkbox">
        Live
      </label>

      <button id="saveTour" type="button" style="padding:10px; border:1px solid #b86b2a; background:#2b2b2b; color:#b86b2a; cursor:pointer;">
        SAVE
      </button>

      <div id="adminMsg" style="color:rgba(255,255,255,0.6); font:400 14px/1 system-ui;"></div>
    </div>
  </div>
</main>   


<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-text">© Tour The Lakes</div>
  </div>
</footer>



<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
    authDomain: "tourthelakes-1e165.firebaseapp.com",
    databaseURL: "https://tourthelakes-1e165-default-rtdb.firebaseio.com",
    projectId: "tourthelakes-1e165",
    storageBucket: "tourthelakes-1e165.firebasestorage.app",
    messagingSenderId: "470758171431",
    appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
    measurementId: "G-W6JY1LZXTP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  function slugifyTitle(input) {
  return String(input || "")
    .trim()
    .toLowerCase()
    .replace(/['"]/g, "")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
}

const titleEl = document.getElementById("tourTitle");
const imgFileEl = document.getElementById("tourImageFile");
const liveEl = document.getElementById("tourLive");
const saveBtn = document.getElementById("saveTour");
const msgEl = document.getElementById("adminMsg");

saveBtn.addEventListener("click", async () => {
  const title = titleEl.value.trim();
  const isLive = !!liveEl.checked;

  if (!title) {
    msgEl.textContent = "Title required.";
    return;
  }

  const tourId = slugifyTitle(title);
  if (!tourId) {
    msgEl.textContent = "Invalid title.";
    return;
  }

  const file = imgFileEl.files && imgFileEl.files[0] ? imgFileEl.files[0] : null;

  let imageUrl = "";

  try {
    // If an image file is chosen, upload it first
    if (file) {
      const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, "_");
      const stamp = Date.now();
      const path = `tours/${tourId}/images/${stamp}-${safeName}`;

      const storageRef = sRef(storage, path);
      await uploadBytes(storageRef, file);
      imageUrl = await getDownloadURL(storageRef);
    }

    const tourData = {
      title,
      imageUrl,
      isLive
    };

    await set(ref(db, `tours/${tourId}`), tourData);
    msgEl.textContent = `Saved: tours/${tourId}`;
  } catch (err) {
    msgEl.textContent = `Error: ${err?.message || err}`;
  }
});
    
  void db;
    
</script>

</body>
</html>
