<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tour The Lakes</title>
  <meta name="description" content="Guided tours and special events across the Lake District, with commentary, scenic stops and time to explore."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;800&display=swap" rel="stylesheet">

  <!-- Favicon = the circle badge -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='58' fill='%231b3f66' stroke='white' stroke-width='6'/%3E%3Ctext x='60' y='46' text-anchor='middle' fill='white' font-family='Outfit' font-size='18' font-weight='800'%3ETour%3C/text%3E%3Ctext x='60' y='68' text-anchor='middle' fill='white' font-family='Outfit' font-size='18' font-weight='800'%3EThe%3C/text%3E%3Ctext x='60' y='90' text-anchor='middle' fill='white' font-family='Outfit' font-size='18' font-weight='800'%3ELakes%3C/text%3E%3C/svg%3E"/>

  <style>
    :root{
      --ink:#0f2f4f; --ink2:#1b3f66; --accent:#0fa3b1;
      --bg:#f3f5f7; --muted:#6b7280; --card:#fff;
      --radius:20px; --shadow:0 20px 50px rgba(15,47,79,.10);
      --grad: radial-gradient(55% 60% at 60% 40%, #1b3f66 0%, #0f2f4f 60%, #0b2740 100%);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:#0f172a;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    h1,h2,h3{font-family:Outfit,Inter,system-ui; letter-spacing:.2px}
    a{color:var(--ink2);text-decoration:none}
    @media (prefers-reduced-motion:reduce){ *{animation:none!important;transition:none!important} }

    /* ===== Shared floaty banner (header + footer colour) ===== */
    .banner{position:relative;overflow:hidden;color:#fff}
    .banner .layer{position:absolute;inset:-20% -10% auto -10%;height:120%;background:var(--grad)}
    .blob{position:absolute;border-radius:50%;
      background: radial-gradient(closest-side, rgba(15,163,177,.35), rgba(15,163,177,0));
      animation:float 12s ease-in-out infinite alternate}
    .b1{width:40vw;height:40vw;top:-8vw;left:-10vw}
    .b2{width:32vw;height:32vw;bottom:-6vw;right:-8vw;animation-duration:14s}
    @keyframes float{to{transform:translateY(-12px) translateX(8px) scale(1.03)}}

    /* ===== HERO ===== */
    header.banner{padding:78px 16px 60px}
    /* Mobile-first: stack by default (logo on its own row) */
    .hero{
      position:relative;z-index:2;max-width:1100px;margin:0 auto;
      display:grid;gap:18px; grid-template-columns:1fr; padding-inline:6px;
      text-align:center;
    }
    .stamp{
      justify-self:center;
      display:flex;align-items:center;justify-content:center;
      width: clamp(120px, 36vw, 150px);
      height: clamp(120px, 36vw, 150px);
      border-radius:50%;
      box-shadow: inset 0 8px 20px rgba(0,0,0,.25), 0 10px 30px rgba(0,0,0,.25);
      background:
        radial-gradient(circle at 30% 30%, #1c4776, #173a61 60%),
        repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,.15) 0 2px, rgba(0,0,0,0) 2px 4px);
      border:6px solid rgba(255,255,255,.7);
    }
    .stamp span{
      font-family:Outfit; font-weight:800; color:#fff; text-transform:uppercase;
      letter-spacing:.6px; line-height:1.15; font-size: clamp(16px, 2vw, 20px);
    }
    .hero-copy h1{
      margin:0 0 8px; text-wrap: balance;
      font-size: clamp(30px, 7vw, 44px);
    }
    .hero-copy p{
      margin:0; color:#e5e7eb; font-size: clamp(15px, 2.8vw, 18px);
    }
    /* Wide screens: circle left, headline truly centered using symmetric grid */
    @media (min-width:1200px){
      .hero{
        grid-template-columns: clamp(140px,16vw,190px) 1fr clamp(140px,16vw,190px);
        gap:26px; text-align:center; padding-inline:0;
      }
      .stamp{
        justify-self:start;
        width: clamp(150px, 18vw, 190px);
        height: clamp(150px, 18vw, 190px);
        border-width:7px;
      }
      .hero-copy{grid-column:2}
    }

    /* ===== Nav ===== */
    nav{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;background:#152a44;padding:12px}
    nav a{color:#e5e7eb;padding:10px 14px;border-radius:10px;font-weight:600}
    nav a:hover{background:#0e223a}

    /* ===== “Card-less” modern sections ===== */
    main{max-width:1100px;margin:28px auto;padding:0 14px}
    .section{
      position:relative; padding:28px 8px 22px; margin:8px 0 26px;
    }
    /* Slim accent rail on the left that fades */
    .section::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:6px;
      background:linear-gradient(180deg, rgba(15,163,177,.4), rgba(27,63,102,.4));
      border-radius:6px; opacity:.6;
    }
    .section-inner{
      margin-left:18px; padding:18px 18px 8px; border-radius:16px;
      background:linear-gradient(180deg, #ffffff, #fbfdff);
      box-shadow:0 6px 30px rgba(15,47,79,.08);
      border:1px solid #e8eef5;
    }
    .section h2{
      margin:0 0 12px; color:var(--ink);
      display:inline-block; padding-bottom:8px;
      background:
        linear-gradient(#0000,#0000) padding-box,
        linear-gradient(90deg, rgba(15,163,177,.5), rgba(27,63,102,.5)) border-box;
      border-bottom:3px solid transparent;
    }
    .muted{color:var(--muted)}

    /* Event/Tour items still use cards */
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:780px){.grid{grid-template-columns:1fr 1fr}}
    .event{border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;background:#fff;transition:transform .15s ease, box-shadow .15s ease}
    .event:hover{transform:translateY(-2px); box-shadow:0 16px 40px rgba(15,47,79,.12)}
    .imgwrap{width:100%;aspect-ratio:16/9;background:#eef3f8}
    .imgwrap img{width:100%;height:100%;object-fit:cover;display:block}
    .pad{padding:14px}
    .event h3{margin:0 0 6px;color:var(--ink)}
    .meta{font-size:14px;color:var(--muted);margin:2px 0 10px}
    .closed{opacity:.62}
    .btn{display:inline-block;border:0;border-radius:12px;padding:10px 16px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn:hover{filter:brightness(.94)}
    .pill{display:inline-block;padding:4px 9px;border-radius:999px;font-size:12px;margin-left:6px}
    .pill.ok{background:#e6fffb;color:#064e4e}
    .pill.closed{background:#fff1e6;color:#9a3412}

    /* Nicer empty state */
    .empty{
      display:inline-block;border:2px dashed #cdd8e6;border-radius:999px;padding:10px 14px;color:#51607a;background:#f7fbff;
    }

    /* ===== Footer (same gradient + tiny dot) ===== */
    footer.banner{padding:34px 16px}
    footer .inner{position:relative;z-index:2;max-width:1100px;margin:0 auto;text-align:center;color:#d1e3f7}
    #signinDot{
      background:none;border:none;color:#d1e3f7;cursor:pointer;opacity:.45;
      font-size:16px;line-height:1;padding:2px 6px;border-radius:999px
    }
    #signinDot:focus-visible{outline:2px solid rgba(255,255,255,.5)}
    #authMsg{color:#d1e3f7;font-size:12px;min-height:16px;display:block}
  </style>
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header class="banner">
    <div class="layer"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="hero">
      <div class="stamp"><span>Tour<br>The<br>Lakes</span></div>
      <div class="hero-copy">
        <h1>Guided days in the Lake District</h1>
        <p>Stories, stops, and scenery — without the parking stress</p>
      </div>
    </div>
  </header>

  <nav>
    <a href="#about">About</a>
    <a href="#tours">Tours</a>
    <a href="#events">Events</a>
    <a href="#contact">Contact</a>
  </nav>

  <main>
    <section id="about" class="section">
      <div class="section-inner">
        <h2>About</h2>
        <p>Full day tours with commentary, scenic stops and time to explore. A tour runs only once 20 fully paid participants are confirmed before the cut off. No pay on the day.</p>
      </div>
    </section>

    <section id="tours" class="section">
      <div class="section-inner">
        <h2>Upcoming Tours</h2>
        <div id="toursList" class="grid"><span class="empty">Loading tours…</span></div>
      </div>
    </section>

    <section id="events" class="section">
      <div class="section-inner">
        <h2>Special Events</h2>
        <div id="eventsList" class="grid"><span class="empty">Loading events…</span></div>
      </div>
    </section>

    <section id="contact" class="section">
      <div class="section-inner">
        <h2>Contact</h2>
        <p>Email <a href="mailto:info@tourthelakes.com">info@tourthelakes.com</a> for questions or group bookings.</p>
      </div>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="banner">
    <div class="layer"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="inner">
      © <span id="yr"></span> Tour The Lakes
      <button id="signinDot" title=" " aria-label="Staff">•</button>
      <small id="authMsg" aria-live="polite"></small>
    </div>
  </footer>

  <script>document.getElementById('yr').textContent = new Date().getFullYear();</script>

  <!-- ===== PUBLIC DATA + DISCREET AUTH (no auto-open) ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect,
      getRedirectResult, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
      authDomain: "tourthelakes-1e165.firebaseapp.com",
      projectId: "tourthelakes-1e165",
      storageBucket: "tourthelakes-1e165.firebasestorage.app",
      messagingSenderId: "470758171431",
      appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
      measurementId: "G-W6JY1LZXTP"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const provider = new GoogleAuthProvider();
    const ALLOWED_ADMIN_EMAILS = ["info@tourthelakes.com"];

    const $ = (id)=>document.getElementById(id);
    const authMsg = $("authMsg");

    // Public lists
    const isClosed = (dateStr, cutoffStr)=>{const n=new Date(),d=new Date(dateStr),c=new Date(cutoffStr);return n>c||n>d;};
    const fmtUK = s => s ? s.split("-").reverse().join("/") : "";
    function card(d){
      const closed = isClosed(d.date,d.cutoff);
      const el = document.createElement("div");
      el.className = "event" + (closed ? " closed" : "");
      const pill = closed ? `<span class="pill closed">Closed</span>` : `<span class="pill ok">Open</span>`;
      const img = d.imageUrl ? `<div class="imgwrap"><img src="${d.imageUrl}" alt=""></div>` : `<div class="imgwrap"></div>`;
      el.innerHTML = `${img}
        <div class="pad">
          <h3>${d.title} ${pill}</h3>
          <div class="meta"><strong>Date:</strong> ${fmtUK(d.date)} &nbsp; • &nbsp; <strong>Cut off:</strong> ${fmtUK(d.cutoff)} &nbsp; • &nbsp; <strong>Price:</strong> £${Number(d.price).toFixed(0)}</div>
          <p>${d.description}</p>
          ${closed ? `<p class="muted"><em>This listing is now closed.</em></p>` : `<button class="btn" onclick="window.open('${d.paymentLink}','_blank')">Book now</button>`}
        </div>`;
      return el;
    }
    async function renderList(col, mountId){
      const mount = $(mountId);
      mount.innerHTML = `<span class="empty">Loading…</span>`;
      try{
        const q = query(collection(db, col), orderBy("date","asc"));
        const snap = await getDocs(q);
        const arr = []; snap.forEach(x=>arr.push(x.data()));
        const open   = arr.filter(x=>!isClosed(x.date,x.cutoff));
        const closed = arr.filter(x=> isClosed(x.date,x.cutoff));
        mount.innerHTML = "";
        [...open,...closed].forEach(d=> mount.appendChild(card(d)));
        if (!arr.length) mount.innerHTML = `<span class="empty">No ${col} yet.</span>`;
      }catch(e){ console.error(e); mount.innerHTML = `<span class="empty">Could not load ${col}.</span>`; }
    }
    renderList("tours","toursList");
    renderList("events","eventsList");

    // Auth — manual only
    async function openIfAllowed(user){
      const email = user?.email ?? "";
      if (ALLOWED_ADMIN_EMAILS.includes(email)){
        window.open("admin.html","_blank","noopener");
      } else if (user) {
        authMsg.textContent = "Not authorised";
        setTimeout(()=>authMsg.textContent="", 3000);
        await signOut(auth);
      }
    }
    async function doSignIn(){
      if (auth.currentUser) return openIfAllowed(auth.currentUser);
      try{
        const res = await signInWithPopup(auth, provider);
        await openIfAllowed(res.user);
      }catch(err){
        if (err?.code === 'auth/operation-not-supported-in-this-environment' || err?.code === 'auth/popup-blocked'){
          await signInWithRedirect(auth, provider);
        }else{
          console.error(err); authMsg.textContent = "Sign in failed"; setTimeout(()=>authMsg.textContent="", 3000);
        }
      }
    }
    document.getElementById("signinDot").addEventListener("click", doSignIn);
    document.addEventListener("keydown", e=>{ if (e.shiftKey && (e.key==='A'||e.key==='a')) doSignIn(); });

    // Only handle redirect result when present; a plain refresh won’t open admin
    getRedirectResult(auth).then(res => { if (res) openIfAllowed(res.user); })
      .catch(err => { console.error(err); authMsg.textContent = "Sign in failed"; setTimeout(()=>authMsg.textContent="", 3000); });
  </script>

  <script>document.getElementById('yr').textContent = new Date().getFullYear();</script>
</body>
</html>
