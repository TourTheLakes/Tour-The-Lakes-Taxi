<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tour The Lakes</title>
  <meta name="description" content="Guided tours and special events across the Lake District, with commentary, scenic stops and time to explore."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;800&display=swap" rel="stylesheet">

  <!-- Favicon = the circle badge -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='58' fill='%2313161c' stroke='%2386f6ff' stroke-width='4'/%3E%3Ctext x='60' y='46' text-anchor='middle' fill='%23e8f1f8' font-family='Outfit' font-size='18' font-weight='800'%3ETour%3C/text%3E%3Ctext x='60' y='68' text-anchor='middle' fill='%23e8f1f8' font-family='Outfit' font-size='18' font-weight='800'%3EThe%3C/text%3E%3Ctext x='60' y='90' text-anchor='middle' fill='%23e8f1f8' font-family='Outfit' font-size='18' font-weight='800'%3ELakes%3C/text%3E%3C/svg%3E"/>

  <style>
    :root{
      --bg:#0e1116; --ink:#e8f1f8; --muted:#a8b0bb;
      --neon:#55f0ff; --neon2:#00d2ff; --line:#273341;
      --grad: radial-gradient(70% 80% at 65% 30%, #15212c 0%, #0e141b 55%, #0b0e13 100%);
      --logo:188px;
      --card:#0f141b;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      line-height:1.55
    }
    h1,h2,h3{font-family:Outfit,Inter,system-ui; letter-spacing:.2px}
    a{color:var(--neon);text-decoration:none}
    @media (prefers-reduced-motion:reduce){
      *{animation:none!important;transition:none!important}
    }

    /* Banners */
    .banner{position:relative;overflow:hidden;color:var(--ink)}
    .banner .layer{position:absolute;inset:-25% -10% auto -10%;height:125%;background:var(--grad)}
    .glow{position:absolute;border-radius:50%;filter:blur(40px);opacity:.55}
    .g1{width:540px;height:540px;left:-180px;top:-180px;background:radial-gradient(closest-side, rgba(85,240,255,.35), rgba(85,240,255,0))}
    .g2{width:420px;height:420px;right:-140px;bottom:-160px;background:radial-gradient(closest-side, rgba(0,210,255,.25), rgba(0,210,255,0))}

    /* HERO */
    header.banner{padding:80px 16px 64px}
    .hero{
      position:relative;z-index:2;max-width:1100px;margin:0 auto;
      display:grid;gap:20px;grid-template-columns:1fr;padding-inline:6px;text-align:center
    }
    .stamp{
      justify-self:center;width:clamp(124px,36vw,150px);height:clamp(124px,36vw,150px);
      border-radius:50%;display:flex;align-items:center;justify-content:center;
      background:
        radial-gradient(circle at 30% 30%, #1a2633, #121a22 60%),
        repeating-radial-gradient(circle at 50% 50%, rgba(255,255,255,.12) 0 2px, rgba(0,0,0,0) 2px 4px);
      border:4px solid rgba(134,246,255,.85);
      box-shadow:0 0 0 6px rgba(134,246,255,.12), inset 0 12px 26px rgba(0,0,0,.45);
      font-family:Outfit;font-weight:800;font-size:clamp(16px,2vw,20px);line-height:1.15;text-transform:uppercase
    }
    .hero-copy h1{margin:0 0 10px;font-size:clamp(30px,7vw,46px);text-wrap:balance}
    .hero-copy p{margin:0;color:var(--muted);font-size:clamp(15px,2.8vw,18px)}
    @media(min-width:1200px){
      .hero{grid-template-columns:var(--logo) 1fr var(--logo);gap:28px;padding-inline:0}
      .stamp{justify-self:start;width:var(--logo);height:var(--logo);border-width:5px}
      .hero-copy{grid-column:2}
    }

    /* NAV */
    nav{
      display:flex;gap:12px;justify-content:center;flex-wrap:wrap;
      background:linear-gradient(180deg,#0d1218,#0a0e13);
      border-top:1px solid #0c1117;border-bottom:1px solid #0c1117;padding:12px
    }
    nav a{
      color:#d7e3ee;padding:10px 14px;border-radius:10px;font-weight:600
    }
    nav a:hover{background:#121822;color:#f2fbff}

    /* Sections */
    main{max-width:1100px;margin:30px auto;padding:0 14px}
    .section{margin:22px 0}
    .section h2{
      margin:0;color:#eaf4fb;display:inline-block;padding-bottom:8px;position:relative
    }
    .section h2::after{
      content:"";display:block;height:3px;margin-top:6px;width:clamp(90px,14vw,180px);
      background:linear-gradient(90deg,var(--neon),var(--neon2));border-radius:2px
    }
    .muted{color:var(--muted)}

    /* Cards */
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:780px){.grid{grid-template-columns:1fr 1fr}}
    .event{
      background:var(--card);border:1px solid #1f2a36;border-radius:14px;overflow:hidden;
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease
    }
    .event:hover{transform:translateY(-2px);box-shadow:0 14px 36px rgba(0,0,0,.35);border-color:#2a3a4a}
    .imgwrap{width:100%;aspect-ratio:16/9;background:#0b1016}
    .imgwrap img{width:100%;height:100%;object-fit:cover;display:block}
    .pad{padding:14px;color:#d6e2ed}
    .event h3{margin:0 0 8px;color:#eaf4fb}
    .meta{font-size:14px;color:#9eb0c4;margin:2px 0 10px}
    .closed{opacity:.62}
    .btn{
      display:inline-block;border:0;border-radius:10px;padding:10px 16px;
      background:linear-gradient(90deg,var(--neon),var(--neon2));color:#00242a;font-weight:800;cursor:pointer
    }
    .btn:focus-visible{outline:2px solid rgba(134,246,255,.5)}
    .pill{display:inline-block;padding:4px 9px;border-radius:999px;font-size:12px;margin-left:6px}
    .pill.ok{background:rgba(85,240,255,.16);color:#86f6ff;border:1px solid rgba(134,246,255,.35)}
    .pill.closed{background:#2a1a1a;color:#ffb4a6;border:1px solid #7a3a3a}
    .empty{
      display:inline-block;border:1px dashed #3a4756;border-radius:999px;padding:10px 14px;color:#aeb8c6;background:#0f141b
    }

    /* Details drawer */
    details{border-top:1px solid #1f2a36}
    details[open] summary .chev{transform:rotate(180deg)}
    summary{
      list-style:none;cursor:pointer;padding:10px 14px;color:#bcd0e3;display:flex;align-items:center;gap:8px
    }
    summary::-webkit-details-marker{display:none}
    .chev{transition:transform .2s}
    .drawer{padding:6px 14px 14px}
    .bar{height:8px;background:#0b1016;border-radius:999px;overflow:hidden;border:1px solid #2a3948;margin:6px 0 10px}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--neon),var(--neon2));width:0%}
    .flow p{margin:8px 0}
    .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b1016;border:1px solid #253243;border-radius:6px;padding:2px 6px}

    /* Interest form – neat, fixed heights */
    .interest{margin-top:10px;padding:10px;border:1px solid #223042;border-radius:12px;background:#0e141a}
    .interest label{display:block;font-weight:600;margin:8px 0 6px}
    .interest input, .interest select{
      width:100%;padding:10px;border-radius:10px;border:1px solid #2a3948;background:#0f141b;color:#dfeaf3
    }
    .row2{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:600px){.row2{grid-template-columns:1fr 1fr}}
    /* number inputs tidy */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    input[type=number]{-moz-appearance:textfield}
    .okmsg{color:#9af5ff;margin-top:8px}
    .errmsg{color:#ffb4a6;margin-top:8px}

    /* Footer */
    footer.banner .inner{position:relative;z-index:2;max-width:1100px;margin:0 auto;text-align:center;color:#cfe6ee;padding:36px 16px}
    #signinDot{background:none;border:none;color:#bfefff;cursor:pointer;opacity:.55;font-size:16px;line-height:1;padding:2px 6px;border-radius:999px}
    #signinDot:focus-visible{outline:2px solid rgba(134,246,255,.5)}
    #authMsg{display:block;min-height:16px}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="banner">
    <div class="layer"></div><div class="glow g1"></div><div class="glow g2"></div>
    <div class="hero">
      <div class="stamp">Tour<br>The<br>Lakes</div>
      <div class="hero-copy">
        <h1>It’s time spent together – Let’s go</h1>
        <p>Stories&nbsp;|&nbsp;Friends&nbsp;|&nbsp;Scenery</p>
      </div>
    </div>
  </header>


  <nav>
    <a href="#about">About</a>
    <a href="#tours">Tours</a>
    <a href="#events">Events</a>
    <a href="#contact">Contact</a>
  </nav>

  <main>
    <section id="about" class="section">
      <h2>About</h2>
      <p class="muted">
        Tour The Lakes is about bringing people together. In the last few years a lot of us have felt more distant, and it can be harder to step out and connect. A day in the Lakes helps with that. It gives people a shared experience, a chance to meet new faces, and time with friends old and new.
      </p>
      <p class="muted">
        This isn’t about putting on a show. It’s me doing what I love and opening the door for others to enjoy it too. Some days it’s a small group in a minibus, other days it’s a larger coach, and sometimes the route itself calls for something smaller. Whatever the size, the feeling stays the same — safe, relaxed and welcoming.
      </p>
      <p class="muted">
        Not every trip is for everyone and that’s part of the charm. Some people prefer a quiet garden walk, others want a bit of adventure. What matters is that you choose the day that suits you and leave feeling lighter, rested and ready to come back.
      </p>
      <p class="muted">
        The Lakes don’t promise perfect weather, but they do promise character. Even when the rain turns up, the stories, the company and the scenery make it worth it. That’s what Tour The Lakes is here for — time shared, moments remembered and reasons to return.
      </p>
    </section>

    <section id="tours" class="section">
      <h2>Upcoming Tours</h2>
      <div id="toursList" class="grid"><span class="empty">Loading tours…</span></div>
    </section>

    <section id="events" class="section">
      <h2>Special Events</h2>
      <div id="eventsList" class="grid"><span class="empty">Loading events…</span></div>
    </section>

    <section id="contact" class="section">
      <h2>Contact</h2>
      <p class="muted">
        The best way to reach us is by email at
        <a href="mailto:info@tourthelakes.com">info@tourthelakes.com</a>.
        We’re a small team out on the road a lot, so we don’t run a live phone line.
        Email is monitored throughout the day and we aim to reply within a couple of hours.
      </p>
      <p class="muted">
        If an event has limited spaces, don’t worry — your place in the queue is based on the
        <strong>timestamp of your email</strong>. That way it’s fair and there’s no need to panic.
      </p>
      <p class="muted">
        A valid email address is essential because confirmations, payment links and any paperwork are sent by email.
        We also ask for a phone number as a backup, but we’ll only use it if we can’t reach you by email.
      </p>
      <p class="muted">
        Ask anything — dates, accessibility, what to bring — and we’ll help you pick the day that suits you.
      </p>
    </section>
    
  <!-- FOOTER -->
  <footer class="banner">
    <div class="layer"></div><div class="glow g1"></div><div class="glow g2"></div>
    <div class="inner">
      © <span id="yr"></span> Tour The Lakes
      <button id="signinDot" title=" " aria-label="Staff">•</button>
      <small id="authMsg" aria-live="polite"></small>
    </div>
  </footer>

  <!-- APP (unchanged logic) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
  authDomain: "tourthelakes-1e165.firebaseapp.com",
  projectId: "tourthelakes-1e165",
  storageBucket: "tourthelakes-1e165.firebasestorage.app",
  messagingSenderId: "470758171431",
  appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
  measurementId: "G-W6JY1LZXTP"
};

    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const provider = new GoogleAuthProvider();
    const ALLOWED = ["info@tourthelakes.com"];

    const $ = id => document.getElementById(id);
    const authMsg = $("authMsg");

    // helpers
    const fmtUK = s => s ? s.split("-").reverse().join("/") : "";
    const isClosed = (d,c)=>{const n=new Date();return n>new Date(c)||n>new Date(d);};
    const daysUntil = s => { if(!s) return null; const n=new Date();n.setHours(0,0,0,0); const d=new Date(s);d.setHours(0,0,0,0); return Math.round((d-n)/86400000); };

    function escapeHtml(s){return (s||"").replace(/[&<>"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));}

    // card
function card(col, id, data){
  const closed = isClosed(data.date, data.cutoff) || !!data.closed;
  const el = document.createElement("div");
  el.className = "event" + (closed ? " closed" : "");
  const pill = closed ? `<span class="pill closed">Closed</span>` : `<span class="pill ok">Open</span>`;
  const img = data.imageUrl ? `<div class="imgwrap"><img src="${data.imageUrl}" alt=""></div>` : `<div class="imgwrap"></div>`;
  const dayMsg = (()=>{ const d=daysUntil(data.cutoff); if(d==null) return ""; if(d<0) return "past cutoff"; if(d===0) return "cutoff today"; return `${d} day${d===1?"":"s"} to cutoff`; })();

  const cutoffHtml = dayMsg
    ? ' &nbsp; • &nbsp; <span class="muted">' + dayMsg + '</span>'
    : '';

  el.innerHTML = `
    ${img}
    <div class="pad">
      <h3>${data.title} ${pill}</h3>
      <div class="meta">
        <strong>Date:</strong> ${fmtUK(data.date)}
        &nbsp; • &nbsp; <strong>Cut off:</strong> ${fmtUK(data.cutoff)}
        &nbsp; • &nbsp; <strong>Price:</strong> £${Number(data.price||0).toFixed(0)}
        ${cutoffHtml}
      </div>
      <details>
        <summary><span class="chev">▾</span> Details</summary>
        <div class="drawer">
          <div class="flow">
            <p><strong>About this ${col.slice(0,-1)}:</strong></p>
            <p>${escapeHtml(data.description || "")}</p>
          </div>
          <div id="prog-${col}-${id}" style="margin-top:10px"></div>

          <form class="interest" id="form-${col}-${id}">
            <p style="margin:0 0 6px"><strong>Register interest</strong></p>
            <div class="row2">
              <div>
                <label for="n-${id}">Name</label>
                <input id="n-${id}" name="name" placeholder="Full name"/>
              </div>
              <div>
                <label for="e-${id}">Email *</label>
                <input id="e-${id}" name="email" type="email" required placeholder="name@example.com"/>
              </div>
            </div>
            <div class="row2">
              <div>
                <label for="p-${id}">Phone</label>
                <input id="p-${id}" name="phone" placeholder="+44…"/>
              </div>
              <div>
                <label for="s-${id}">Places</label>
                <input id="s-${id}" name="seats" type="number" min="1" value="1"/>
              </div>
            </div>
            <div style="margin-top:10px">
              <button class="btn" ${closed ? "disabled" : ""}>Send</button>
            </div>
            <div class="okmsg" id="ok-${col}-${id}" style="display:none">Thanks — we’ve got your interest. We’ll be in touch.</div>
            <div class="errmsg" id="er-${col}-${id}" style="display:none">Could not send. Please try again.</div>
          </form>
        </div>
      </details>
    </div>
  `;

  // lazy progress load (no Firestore query on public page)
  const details = el.querySelector("details");
  const progHost = el.querySelector(`#prog-${col}-${id}`);
  details.addEventListener("toggle", ()=>{
    if (!details.open) return;
    if (!data.capacity) { progHost.innerHTML = ""; return; }
    const cap = Number(data.capacity || 0);
    const min = Number(data.minNeeded ?? 20);
    progHost.innerHTML = `
      <div class="meta"><strong>Capacity:</strong> ${cap} · Min to run: ${min}</div>
      <div class="bar"><span style="width:0%"></span></div>
    `;
  });

  // interest submit
  const form = el.querySelector(`#form-${col}-${id}`);
  const ok   = el.querySelector(`#ok-${col}-${id}`);
  const er   = el.querySelector(`#er-${col}-${id}`);
  form.addEventListener("submit", async (e)=>{
    e.preventDefault();
    ok.style.display="none"; er.style.display="none";
    const fd = new FormData(form);
    const email = (fd.get("email")+"").trim();
    if (!email){ er.style.display="block"; return; }
    try{
      await addDoc(collection(db, col, id, "interests"), {
        name:(fd.get("name")+"").trim(),
        email,
        phone:(fd.get("phone")+"").trim(),
        seats:Number(fd.get("seats")||1),
        createdAt: serverTimestamp()
      });
      form.reset();
      ok.style.display="block";
    }catch(err){
      console.error(err);
      er.style.display="block";
    }
  });

  return el;
}

    // lists
    async function renderList(col, mountId){
      const mount = $(mountId);
      mount.innerHTML = `<span class="empty">Loading…</span>`;
      try{
        const qy = query(collection(db, col), orderBy("date","asc"));
        const snap = await getDocs(qy);
        const items = [];
        snap.forEach(d=> items.push({ id:d.id, data:d.data() }));
        
        const open = items.filter(x=>!isClosed(x.data.date, x.data.cutoff) && !x.data.closed);
        const closed = items.filter(x=> isClosed(x.data.date, x.data.cutoff) || x.data.closed);
        mount.innerHTML = "";
        [...open,...closed].forEach(({id,data})=> mount.appendChild(card(col,id,data)));
        if (!items.length) mount.innerHTML = `<span class="empty">No ${col} yet.</span>`;
      }catch(e){ console.error(e); mount.innerHTML = `<span class="empty">Could not load ${col}.</span>`; }
    }
    renderList("tours","toursList");
    renderList("events","eventsList");

        // Admin gate (MISSING BEFORE)
    async function openIfAllowed(user){
      const email = user?.email ?? "";
      if (ALLOWED.includes(email)){
        window.open("admin.html","_blank","noopener");
      } else if (user){
        authMsg.textContent = "Not authorised";
        setTimeout(()=>authMsg.textContent="", 3000);
        await signOut(auth);
      }
    }
    
    // Admin sign-in
    async function doSignIn(){
      if (auth.currentUser) return openIfAllowed(auth.currentUser);
      try{
        const res = await signInWithPopup(auth, provider);
        await openIfAllowed(res.user);
      }catch(err){
        if (err?.code==='auth/operation-not-supported-in-this-environment' || err?.code==='auth/popup-blocked'){
          await signInWithRedirect(auth, provider);
        }else{
          console.error(err);
          authMsg.textContent = "Sign in failed";
          setTimeout(()=>authMsg.textContent="", 3000);
        }
      }
    }

    document.getElementById("signinDot").addEventListener("click", doSignIn);

    // handle return from signInWithRedirect (MISSING BEFORE)
    getRedirectResult(auth)
      .then(res => { if (res?.user) return openIfAllowed(res.user); })
      .catch(err => console.error(err));
  </script>

<script>
  const yr = document.getElementById('yr');
  if (yr) yr.textContent = new Date().getFullYear();
</script>
</body>
</html>
