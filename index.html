<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tour The Lakes</title>
  <meta name="description" content="Guided tours and special events across the Lake District, with commentary, scenic stops and time to explore."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@600;800&display=swap" rel="stylesheet">
  <!-- Tiny inline favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='8' fill='%231b3f66'/%3E%3Cpath d='M10 42c10-6 16-10 22-10s12 4 22 10' stroke='%23fff' stroke-width='6' fill='none'/%3E%3Ccircle cx='26' cy='24' r='5' fill='%230fa3b1'/%3E%3C/svg%3E">
  <style>
    :root{
      --ink:#0f2f4f; --ink2:#1b3f66; --accent:#0fa3b1;
      --bg:#f3f5f7; --card:#fff; --muted:#6b7280;
      --radius:18px; --shadow:0 20px 50px rgba(15,47,79,.10);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:#1f2937;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    h1,h2,h3{font-family:Outfit,Inter,system-ui; letter-spacing:.2px}
    a{color:var(--ink2);text-decoration:none}

    /* Shared hero/foot visuals */
    .banner{
      position:relative; overflow:hidden; color:#fff; text-align:center;
      padding:56px 16px 40px;
    }
    .layer{
      position:absolute; inset:-20% -10% auto -10%; height:120%;
      background: radial-gradient(55% 60% at 60% 40%, #1b3f66 0%, #0f2f4f 60%, #0b2740 100%);
      filter:saturate(1.05);
    }
    .blob{position:absolute; border-radius:50%;
      background: radial-gradient(closest-side, rgba(15,163,177,.35), rgba(15,163,177,0));
      animation: float 12s ease-in-out infinite alternate}
    .b1{width:40vw; height:40vw; top:-8vw; left:-10vw}
    .b2{width:32vw; height:32vw; bottom:-6vw; right:-8vw; animation-duration:14s}
    @keyframes float{to{transform:translateY(-12px) translateX(8px) scale(1.03)}}

    .banner-inner{
      position:relative; z-index:2; max-width:1100px; margin:0 auto;
      display:grid; align-items:center; gap:26px; grid-template-columns:160px 1fr;
    }
    .stamp-svg{filter:drop-shadow(0 14px 32px rgba(0,0,0,.28))}
    .stamp-svg svg{transform:rotate(-5deg); transition:transform .6s ease}
    .banner:hover .stamp-svg svg{transform:rotate(-3deg) scale(1.015)}
    .banner-copy h1{margin:6px 0 8px; font-size:42px; color:#fff}
    .banner-copy p{margin:0; color:#e5e7eb}
    @media (max-width:720px){
      .banner-inner{grid-template-columns:1fr; text-align:center}
      .stamp-svg{margin:0 auto}
      .banner-copy h1{font-size:32px}
    }

    nav{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;background:#152a44;padding:10px}
    nav a{color:#e5e7eb;padding:10px 14px;border-radius:10px;font-weight:600}
    nav a:hover{background:#0e223a}

    main{max-width:1100px;margin:22px auto;padding:0 14px}
    section{background:var(--card);border-radius:var(--radius);margin:18px 0;padding:20px;box-shadow:var(--shadow)}
    h2{margin:0 0 12px;padding-bottom:8px;border-bottom:3px solid #e8eef5;color:var(--ink)}

    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:780px){.grid{grid-template-columns:1fr 1fr}}
    .event{border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;background:#fff;transition:transform .15s ease, box-shadow .15s ease}
    .event:hover{transform:translateY(-2px); box-shadow:0 16px 40px rgba(15,47,79,.12)}
    .imgwrap{width:100%;aspect-ratio:16/9;background:#eef3f8}
    .imgwrap img{width:100%;height:100%;object-fit:cover;display:block}
    .pad{padding:14px}
    .event h3{margin:0 0 6px;color:var(--ink)}
    .meta{font-size:14px;color:var(--muted);margin:2px 0 10px}
    .closed{opacity:.62}
    .btn{display:inline-block;border:0;border-radius:12px;padding:10px 16px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn:hover{filter:brightness(.94)}
    .pill{display:inline-block;padding:4px 9px;border-radius:999px;font-size:12px;margin-left:6px}
    .pill.ok{background:#e6fffb;color:#064e4e}
    .pill.closed{background:#fff1e6;color:#9a3412}

    /* Footer mirrors header, plus small login row */
    footer{margin-top:24px}
    .footer-inner{align-items:center}
    .foot-controls{display:flex;gap:12px;justify-content:flex-end;align-items:center}
    .foot-controls small{color:#d1e3f7}
    .signin{background:#0fa3b1}
  </style>
</head>
<body>
  <!-- HEADER (left aligned) -->
  <header class="banner">
    <div class="layer"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="banner-inner">
      <!-- stamp -->
      <div class="stamp-svg" aria-hidden="true">
        <svg viewBox="0 0 200 200" width="160" height="160" role="img">
          <defs>
            <filter id="rough" x="-10%" y="-10%" width="120%" height="120%">
              <feTurbulence type="fractalNoise" baseFrequency="0.85" numOctaves="2" seed="3" result="noise"/>
              <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.0" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
            <linearGradient id="bandGrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#224b7a"/><stop offset="100%" stop-color="#193a60"/>
            </linearGradient>
          </defs>
          <circle cx="100" cy="100" r="92" fill="none" stroke="#1b3f66" stroke-width="10" filter="url(#rough)"/>
          <circle cx="100" cy="100" r="78" fill="none" stroke="#1b3f66" stroke-width="6" filter="url(#rough)"/>
          <circle cx="100" cy="100" r="62" fill="none" stroke="#1b3f66" stroke-width="3" opacity=".85" filter="url(#rough)"/>
          <g fill="#0fa3b1" transform="rotate(-6 100 100)">
            <polygon points="100,26 104,38 117,38 106,45 110,57 100,49 90,57 94,45 83,38 96,38"/>
            <polygon points="174,100 178,112 191,112 180,119 184,131 174,123 164,131 168,119 157,112 170,112"/>
            <polygon points="100,174 104,186 117,186 106,193 110,205 100,197 90,205 94,193 83,186 96,186"/>
            <polygon points="26,100 30,112 43,112 32,119 36,131 26,123 16,131 20,119 9,112 22,112"/>
          </g>
          <g filter="url(#rough)" transform="rotate(-6 100 100)">
            <rect x="20" y="80" rx="14" ry="14" width="160" height="40" fill="url(#bandGrad)" stroke="#173a61" stroke-width="3"/>
            <rect x="22" y="90" rx="10" ry="10" width="156" height="22" fill="none" stroke="#0fa3b1" stroke-width="2" opacity=".9"/>
            <text x="100" y="100" dominant-baseline="middle" text-anchor="middle"
                  fill="#ffffff" stroke="#0fa3b1" stroke-width="0.8" paint-order="stroke fill"
                  font-family="Outfit, Inter, sans-serif" font-weight="900" font-size="22" letter-spacing="2.4">
              TOUR THE LAKES
            </text>
          </g>
        </svg>
      </div>
      <div class="banner-copy">
        <h1>Guided days in the Lake District</h1>
        <p>Stories, stops, and scenery — without the parking stress</p>
      </div>
    </div>
  </header>

  <nav>
    <a href="#about">About</a>
    <a href="#tours">Tours</a>
    <a href="#events">Events</a>
    <a href="#contact">Contact</a>
  </nav>

  <main>
    <section id="about">
      <h2>About</h2>
      <p>Full day tours with commentary, scenic stops and time to explore. A tour runs only once 20 fully paid participants are confirmed before the cut off. No pay on the day.</p>
    </section>

    <section id="tours">
      <h2>Upcoming Tours</h2>
      <div id="toursList" class="grid"><p class="muted">Loading tours…</p></div>
    </section>

    <section id="events">
      <h2>Special Events</h2>
      <div id="eventsList" class="grid"><p class="muted">Loading events…</p></div>
    </section>

    <section id="contact">
      <h2>Contact</h2>
      <p>Email <a href="mailto:info@tourthelakes.com">info@tourthelakes.com</a> for questions or group bookings.</p>
    </section>
  </main>

  <!-- FOOTER: visually mirrors header, includes Sign in -->
  <footer class="banner" style="padding:32px 16px 36px">
    <div class="layer"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="banner-inner footer-inner">
      <!-- same stamp for symmetry -->
      <div class="stamp-svg" aria-hidden="true">
        <!-- reuse the exact same SVG for consistency -->
        <svg viewBox="0 0 200 200" width="100" height="100" role="img" aria-hidden="true">
          <defs>
            <filter id="rough2" x="-10%" y="-10%" width="120%" height="120%">
              <feTurbulence type="fractalNoise" baseFrequency="0.85" numOctaves="2" seed="4" result="noise"/>
              <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.0" xChannelSelector="R" yChannelSelector="G"/>
            </filter>
            <linearGradient id="bandGrad2" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#224b7a"/><stop offset="100%" stop-color="#193a60"/>
            </linearGradient>
          </defs>
          <circle cx="100" cy="100" r="92" fill="none" stroke="#1b3f66" stroke-width="10" filter="url(#rough2)"/>
          <circle cx="100" cy="100" r="78" fill="none" stroke="#1b3f66" stroke-width="6" filter="url(#rough2)"/>
          <circle cx="100" cy="100" r="62" fill="none" stroke="#1b3f66" stroke-width="3" opacity=".85" filter="url(#rough2)"/>
          <g filter="url(#rough2)" transform="rotate(-6 100 100)">
            <rect x="35" y="92" rx="10" ry="10" width="130" height="26" fill="url(#bandGrad2)" stroke="#173a61" stroke-width="2"/>
            <text x="100" y="105" dominant-baseline="middle" text-anchor="middle"
                  fill="#ffffff" stroke="#0fa3b1" stroke-width="0.6" paint-order="stroke fill"
                  font-family="Outfit, Inter, sans-serif" font-weight="900" font-size="16" letter-spacing="1.8">
              TOUR THE LAKES
            </text>
          </g>
        </svg>
      </div>

      <div class="foot-controls" style="justify-content:space-between; width:100%">
        <small>© <span id="yr"></span> Tour The Lakes</small>
        <div>
          <button id="signInBtn" class="btn signin">Sign in with Google</button>
          <small id="authStatus"></small>
        </div>
      </div>
    </div>
  </footer>

  <!-- DATA + AUTH (reads only here; auth just launches admin.html) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { 
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, onAuthStateChanged, signOut 
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { 
      getFirestore, collection, getDocs, query, orderBy 
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    // Firebase config (unchanged)
    const firebaseConfig = {
      apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
      authDomain: "tourthelakes-1e165.firebaseapp.com",
      projectId: "tourthelakes-1e165",
      storageBucket: "tourthelakes-1e165.firebasestorage.app",
      messagingSenderId: "470758171431",
      appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
      measurementId: "G-W6JY1LZXTP"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // Only these accounts can open admin.html
    const ALLOWED_ADMIN_EMAILS = ["info@tourthelakes.com"];

    const $ = (id)=>document.getElementById(id);
    $("yr").textContent = new Date().getFullYear();
    const signInBtn = $("signInBtn");
    const authStatus = $("authStatus");

    // --- PUBLIC LISTS ---
    const isClosed = (dateStr, cutoffStr)=>{
      const now = new Date(), d = new Date(dateStr), c = new Date(cutoffStr);
      return now > c || now > d;
    };
    const fmtUK = s => s ? s.split("-").reverse().join("/") : "";

    function card(data){
      const closed = isClosed(data.date, data.cutoff);
      const div = document.createElement("div");
      div.className = "event" + (closed ? " closed" : "");
      const pill = closed ? `<span class="pill closed">Closed</span>` : `<span class="pill ok">Open</span>`;
      const img = data.imageUrl ? `<div class="imgwrap"><img src="${data.imageUrl}" alt=""></div>` : `<div class="imgwrap"></div>`;
      div.innerHTML = `
        ${img}
        <div class="pad">
          <h3>${data.title} ${pill}</h3>
          <div class="meta">
            <strong>Date:</strong> ${fmtUK(data.date)}
            &nbsp; • &nbsp; <strong>Cut off:</strong> ${fmtUK(data.cutoff)}
            &nbsp; • &nbsp; <strong>Price:</strong> £${Number(data.price).toFixed(0)}
          </div>
          <p>${data.description}</p>
          ${closed ? `<p class="muted"><em>This listing is now closed.</em></p>` :
            `<button class="btn" onclick="window.open('${data.paymentLink}','_blank')">Book now</button>`}
        </div>
      `;
      return div;
    }

    async function renderList(colName, mountId){
      const mount = $(mountId);
      mount.innerHTML = `<p class="muted">Loading…</p>`;
      try{
        const q = query(collection(db, colName), orderBy("date","asc"));
        const snap = await getDocs(q);
        const items = [];
        snap.forEach(d=> items.push(d.data()));
        const open = items.filter(x=>!isClosed(x.date,x.cutoff));
        const closed = items.filter(x=>isClosed(x.date,x.cutoff));
        mount.innerHTML = "";
        [...open,...closed].forEach(data=> mount.appendChild(card(data)));
        if (items.length===0) mount.innerHTML = `<p class="muted">No ${colName} yet.</p>`;
      }catch(err){
        console.error(err); mount.innerHTML = `<p class="muted">Could not load ${colName}.</p>`;
      }
    }
    renderList("tours","toursList");
    renderList("events","eventsList");

    // --- FOOTER SIGN-IN -> open admin.html in a new tab if allowed ---
    signInBtn.onclick = async ()=>{
      try{
        const res = await signInWithPopup(auth, provider);
        const email = res.user?.email ?? "";
        if (ALLOWED_ADMIN_EMAILS.includes(email)){
          authStatus.textContent = email;
          window.open("admin.html","_blank","noopener");
        } else {
          authStatus.textContent = "Not authorised";
          alert("That account isn't authorised for admin.");
          await signOut(auth);
        }
      }catch(err){
        // Fallback to redirect if popup blocked
        if (err?.code === 'auth/operation-not-supported-in-this-environment' ||
            err?.code === 'auth/popup-blocked' || err?.code === 'auth/popup-closed-by-user'){
          await signInWithRedirect(auth, provider);
        }else{
          console.error("Auth error:", err?.code, err?.message);
          alert("Sign in failed.");
        }
      }
    };

    // If returning from redirect, auto-open admin for allowed users
    onAuthStateChanged(auth, user=>{
      if (!user) return;
      const email = user.email ?? "";
      authStatus.textContent = email;
      if (ALLOWED_ADMIN_EMAILS.includes(email)){
        // Only open if we're on the public page (defensive)
        if (!/admin\.html$/i.test(location.pathname)){
          window.open("admin.html","_blank","noopener");
        }
      } else {
        authStatus.textContent = "Not authorised";
        signOut(auth);
      }
    });
  </script>

  <script>document.getElementById('yr').textContent = new Date().getFullYear();</script>
</body>
</html>
