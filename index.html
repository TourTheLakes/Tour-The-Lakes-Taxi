<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tour The Lakes</title>
  <meta name="description" content="Guided tours and special events across the Lake District, with commentary, scenic stops and time to explore."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;800&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='58' fill='%23C7C6C1' stroke='%2300E5FF' stroke-width='4'/%3E%3Ctext x='60' y='66' text-anchor='middle' fill='%2313191f' font-family='Outfit' font-size='22' font-weight='800'%3ETTL%3C/text%3E%3C/svg%3E"/>

  <style>
    :root{
      /* Light base + building palette */
      --bg:#D9DDDC;          /* light stone */
      --bg-2:#EEEFEF;        /* panel tint */
      --ink:#13191f;         /* near-black for text */
      --muted:#4e565c;       /* soft grey text */

      /* Neon accents (festival) */
      --neonB:#00E5FF;       /* electric blue */
      --neonG:#9DFF00;       /* lime */
      --neonY:#FFD347;       /* amber */

      /* Card + lines */
      --card:#F5F6F6;
      --line:#D0D4D4;

      /* Smoky gradient “canvas” */
      --smoke: radial-gradient(80% 90% at 20% 20%, rgba(0,229,255,.18), rgba(0,229,255,0) 60%),
               radial-gradient(80% 90% at 80% 30%, rgba(157,255,0,.20), rgba(157,255,0,0) 60%),
               radial-gradient(90% 100% at 60% 80%, rgba(255,211,71,.18), rgba(255,211,71,0) 60%);
    }

    *{box-sizing:border-box}
    html,body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;
      line-height:1.55
    }
    h1,h2,h3{font-family:Outfit,Inter,system-ui;letter-spacing:.2px;margin:0 0 .4rem}
    a{color:#005a63;text-decoration:none}
    a:hover{color:#003e44}

    /* Motion respect */
    @media (prefers-reduced-motion:reduce){
      *{animation:none!important;transition:none!important}
    }

    /* =================== BANNERS (HERO & FOOTER) =================== */
    .banner{
      position:relative;overflow:hidden;color:var(--ink);
      isolation:isolate; /* keep inner neon shadows tidy */
    }
    .banner .smoke{
      position:absolute;inset:-15% -8%;background:var(--smoke);opacity:.9;z-index:0;
      filter:blur(8px);
    }
    .banner .vignette{
      position:absolute;inset:0;
      background:radial-gradient(120% 100% at 50% -10%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 55%),
                  radial-gradient(120% 100% at 50% 110%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 55%);
      z-index:0;mix-blend-mode:screen;pointer-events:none
    }

    /* HERO */
    header.banner{
      padding:72px 16px 56px;
      background:linear-gradient(180deg,#EDEEEE 0%, #E6E9E9 100%);
      border-bottom:1px solid var(--line);
    }
    .hero{
      position:relative;z-index:1;max-width:1100px;margin:0 auto;
      display:grid;gap:24px;grid-template-columns:1fr;padding-inline:6px;text-align:center
    }
    .stamp{
      justify-self:center;width:clamp(120px,36vw,160px);height:clamp(120px,36vw,160px);
      border-radius:50%;display:flex;align-items:center;justify-content:center;
      background:radial-gradient(circle at 30% 30%, #ffffff, #f1f3f3 60%);
      border:5px solid rgba(0,229,255,.85);
      box-shadow:0 0 0 8px rgba(0,229,255,.12), 0 16px 30px rgba(0,0,0,.08), inset 0 12px 26px rgba(0,0,0,.05);
      font-family:Outfit;font-weight:800;font-size:clamp(16px,2vw,20px);line-height:1.15;text-transform:uppercase;color:#0f1417
    }
    .hero-copy h1{
      font-size:clamp(32px,6.8vw,54px);
      letter-spacing:.3px;
      text-wrap:balance
    }
    .hero-copy p{margin:0;color:var(--muted);font-size:clamp(15px,2.6vw,18px)}

    /* Neon underline accent */
    .spark{
      display:inline-block;position:relative;
    }
    .spark::after{
      content:"";display:block;height:6px;margin:.5rem auto 0;max-width:240px;border-radius:999px;
      background:linear-gradient(90deg,var(--neonB),var(--neonG),var(--neonY));
      filter:drop-shadow(0 0 10px rgba(0,229,255,.45));
    }

    @media(min-width:1200px){
      .hero{grid-template-columns:200px 1fr 200px;gap:30px;padding-inline:0;text-align:left}
      .stamp{justify-self:start}
      .hero-copy{grid-column:2}
      .spark::after{margin-left:0;margin-right:0}
    }

    /* =================== NAV =================== */
    nav{
      position:sticky;top:0;z-index:10;
      display:flex;gap:12px;justify-content:center;flex-wrap:wrap;
      background:rgba(255,255,255,.6);backdrop-filter:saturate(180%) blur(8px);
      border-top:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px
    }
    nav a{
      color:#0f272b;background:#fff;border:1px solid #E5E8E8;
      padding:9px 14px;border-radius:12px;font-weight:600
    }
    nav a:hover{
      border-color:#cfe8ea;box-shadow:0 0 0 3px rgba(0,229,255,.15)
    }

    /* =================== SECTIONS =================== */
    main{max-width:1100px;margin:26px auto;padding:0 14px}
    .section{margin:22px 0}
    .section h2{
      display:inline-block;margin:0 0 4px;color:#0e181c
    }
    .section .accent{
      height:4px;width:clamp(100px,16vw,220px);border-radius:999px;
      background:linear-gradient(90deg,var(--neonB),var(--neonG));
      box-shadow:0 0 0 4px rgba(0,229,255,.08) inset, 0 0 12px rgba(0,229,255,.35);
    }
    .muted{color:var(--muted)}

    /* =================== CARDS =================== */
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:780px){.grid{grid-template-columns:1fr 1fr}}
    .event{
      background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;
      box-shadow:0 18px 40px rgba(0,0,0,.06);
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease
    }
    .event:hover{transform:translateY(-2px);box-shadow:0 16px 44px rgba(0,0,0,.10);border-color:#cbd6d6}
    .imgwrap{width:100%;aspect-ratio:16/9;background:#e9eded}
    .imgwrap img{width:100%;height:100%;object-fit:cover;display:block}
    .pad{padding:14px;color:#1a2328}
    .event h3{margin:0 0 8px}
    .meta{font-size:14px;color:#5b6a72;margin:2px 0 10px}
    .closed{opacity:.6}

    /* Pills */
    .pill{display:inline-block;padding:4px 9px;border-radius:999px;font-size:12px;margin-left:6px;border:1px solid #e2e7e7}
    .pill.ok{background:rgba(157,255,0,.16);color:#2a4c00;border-color:rgba(157,255,0,.35)}
    .pill.closed{background:#fff3f0;color:#9a2c16;border-color:#f1c2b8}

    .btn{
      display:inline-block;border:0;border-radius:12px;padding:10px 16px;font-weight:800;cursor:pointer;
      color:#001c1f;background:linear-gradient(90deg,var(--neonB),var(--neonG));
      box-shadow:0 6px 18px rgba(0,229,255,.25)
    }
    .btn:focus-visible{outline:3px solid rgba(0,229,255,.35);outline-offset:2px}
    .empty{
      display:inline-block;border:1px dashed #cfd7d7;border-radius:999px;padding:10px 14px;color:#727c81;background:#f7f9f9
    }

    /* Details drawer */
    details{border-top:1px solid var(--line);background:#fff}
    summary{
      list-style:none;cursor:pointer;padding:12px 14px;color:#304049;display:flex;align-items:center;gap:8px;font-weight:600
    }
    summary::-webkit-details-marker{display:none}
    .chev{transition:transform .2s}
    details[open] summary .chev{transform:rotate(180deg)}
    .drawer{padding:6px 14px 14px;background:#fff}
    .bar{height:10px;background:#eef3f4;border-radius:999px;overflow:hidden;border:1px solid #dfe6e7;margin:6px 0 10px}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--neonB),var(--neonG));width:0%}
    .flow p{margin:8px 0}
    .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#eef3f4;border:1px solid #d5e0e2;border-radius:6px;padding:2px 6px}

    /* Interest form */
    .interest{margin-top:10px;padding:10px;border:1px solid #dfe6e7;border-radius:12px;background:#f9fbfb}
    .interest label{display:block;font-weight:600;margin:8px 0 6px}
    .interest input, .interest select{
      width:100%;padding:10px;border-radius:10px;border:1px solid #cfd9db;background:#fff;color:#1c2428
    }
    .row2{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:600px){.row2{grid-template-columns:1fr 1fr}}
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    input[type=number]{-moz-appearance:textfield}
    .okmsg{color:#215e00;margin-top:8px}
    .errmsg{color:#9a2c16;margin-top:8px}

    /* =================== FOOTER (edge-to-edge) =================== */
    footer.banner{
      padding:36px 16px;border-top:1px solid var(--line);
      background:linear-gradient(180deg,#EDEEEE 0%, #E6E9E9 100%);
    }
    footer.banner .smoke{inset:-20% -8%}
    footer.banner .inner{
      position:relative;z-index:1;max-width:1100px;margin:0 auto;text-align:center;color:#2e3c42
    }

    /* Staff dot + live region */
    #signinDot{
      background:none;border:1px solid #cfe8ea;color:#003e44;cursor:pointer;font-size:16px;
      line-height:1;padding:2px 8px;border-radius:999px;margin-left:6px
    }
    #signinDot:focus-visible{outline:3px solid rgba(0,229,255,.35);outline-offset:2px}
    #authMsg{display:block;min-height:16px;color:#2e3c42}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="banner">
    <div class="smoke"></div><div class="vignette"></div>
    <div class="hero">
      <div class="stamp">Tour<br>The<br>Lakes</div>
      <div class="hero-copy">
        <h1 class="spark">It’s time spent together — let’s go</h1>
        <p>Stories · Friends · Scenery</p>
      </div>
    </div>
  </header>

  <nav>
    <a href="#about">About</a>
    <a href="#tours">Tours</a>
    <a href="#events">Events</a>
    <a href="#contact">Contact</a>
  </nav>

  <main>
    <section id="about" class="section">
      <h2>About</h2>
      <div class="accent"></div>
      <p class="muted">
        Tour The Lakes brings people together for shared days out in the Lakes: small groups, big views, easy company.
        Pick the day that suits you — quiet garden wanders or a little adventure — and leave feeling lighter.
      </p>
      <p class="muted">
        We can’t guarantee sunshine, but we can promise character: stories, scenery and time well spent.
      </p>
    </section>

    <section id="tours" class="section">
      <h2>Upcoming Tours</h2>
      <div class="accent"></div>
      <div id="toursList" class="grid"><span class="empty">Loading tours…</span></div>
    </section>

    <section id="events" class="section">
      <h2>Special Events</h2>
      <div class="accent"></div>
      <div id="eventsList" class="grid"><span class="empty">Loading events…</span></div>
    </section>

    <section id="contact" class="section">
      <h2>Contact</h2>
      <div class="accent"></div>
      <p class="muted">
        Best way to reach us: <a href="mailto:info@tourthelakes.com">info@tourthelakes.com</a>.
        We’re often on the road, so email gets the fastest response.
      </p>
      <p class="muted">
        When spaces are limited, your place in the queue is based on the <strong>timestamp of your email</strong>.
      </p>
      <p class="muted">
        We send confirmations and payment links by email. A phone number helps as backup if we can’t reach you.
      </p>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="banner">
    <div class="smoke"></div><div class="vignette"></div>
    <div class="inner">
      © <span id="yr"></span> Tour The Lakes
      <button id="signinDot" title="Staff" aria-label="Staff sign-in">•</button>
      <small id="authMsg" aria-live="polite"></small>
    </div>
  </footer>

  <!-- APP (logic unchanged) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
      authDomain: "tourthelakes-1e165.firebaseapp.com",
      projectId: "tourthelakes-1e165",
      storageBucket: "tourthelakes-1e165.firebasestorage.app",
      messagingSenderId: "470758171431",
      appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
      measurementId: "G-W6JY1LZXTP"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const provider = new GoogleAuthProvider();
    const ALLOWED = ["info@tourthelakes.com"];

    const $ = id => document.getElementById(id);
    const authMsg = $("authMsg");

    // helpers
    const fmtUK = s => s ? s.split("-").reverse().join("/") : "";
    const isClosed = (d,c)=>{const n=new Date();return n>new Date(c)||n>new Date(d);};
    const daysUntil = s => { if(!s) return null; const n=new Date();n.setHours(0,0,0,0); const d=new Date(s);d.setHours(0,0,0,0); return Math.round((d-n)/86400000); };
    function escapeHtml(s){return (s||"").replace(/[&<>"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));}

    // card
    function card(col, id, data){
      const closed = isClosed(data.date, data.cutoff) || !!data.closed;
      const el = document.createElement("div");
      el.className = "event" + (closed ? " closed" : "");
      const pill = closed ? `<span class="pill closed">Closed</span>` : `<span class="pill ok">Open</span>`;
      const img = data.imageUrl ? `<div class="imgwrap"><img src="${data.imageUrl}" alt=""></div>` : `<div class="imgwrap"></div>`;
      const dayMsg = (()=>{ const d=daysUntil(data.cutoff); if(d==null) return ""; if(d<0) return "past cutoff"; if(d===0) return "cutoff today"; return `${d} day${d===1?"":"s"} to cutoff`; })();
      const cutoffHtml = dayMsg ? ' &nbsp; • &nbsp; <span class="muted">' + dayMsg + '</span>' : '';

      el.innerHTML = `
        ${img}
        <div class="pad">
          <h3>${data.title} ${pill}</h3>
          <div class="meta">
            <strong>Date:</strong> ${fmtUK(data.date)}
            &nbsp; • &nbsp; <strong>Cut off:</strong> ${fmtUK(data.cutoff)}
            &nbsp; • &nbsp; <strong>Price:</strong> £${Number(data.price||0).toFixed(0)}
            ${cutoffHtml}
          </div>
          <details>
            <summary><span class="chev">▾</span> Details</summary>
            <div class="drawer">
              <div class="flow">
                <p><strong>About this ${col.slice(0,-1)}:</strong></p>
                <p>${escapeHtml(data.description || "")}</p>
              </div>
              <div id="prog-${col}-${id}" style="margin-top:10px"></div>

              <form class="interest" id="form-${col}-${id}">
                <p style="margin:0 0 6px"><strong>Register interest</strong></p>
                <div class="row2">
                  <div>
                    <label for="n-${id}">Name</label>
                    <input id="n-${id}" name="name" placeholder="Full name"/>
                  </div>
                  <div>
                    <label for="e-${id}">Email *</label>
                    <input id="e-${id}" name="email" type="email" required placeholder="name@example.com"/>
                  </div>
                </div>
                <div class="row2">
                  <div>
                    <label for="p-${id}">Phone</label>
                    <input id="p-${id}" name="phone" placeholder="+44…"/>
                  </div>
                  <div>
                    <label for="s-${id}">Places</label>
                    <input id="s-${id}" name="seats" type="number" min="1" value="1"/>
                  </div>
                </div>
                <div style="margin-top:10px">
                  <button class="btn" ${closed ? "disabled" : ""}>Send</button>
                </div>
                <div class="okmsg" id="ok-${col}-${id}" style="display:none">Thanks — we’ve got your interest. We’ll be in touch.</div>
                <div class="errmsg" id="er-${col}-${id}" style="display:none">Could not send. Please try again.</div>
              </form>
            </div>
          </details>
        </div>
      `;

      // lazy capacity bar
      const details = el.querySelector("details");
      const progHost = el.querySelector(`#prog-${col}-${id}`);
      details.addEventListener("toggle", ()=>{
        if (!details.open) return;
        if (!data.capacity) { progHost.innerHTML = ""; return; }
        const cap = Number(data.capacity || 0);
        const min = Number(data.minNeeded ?? 20);
        progHost.innerHTML = `
          <div class="meta"><strong>Capacity:</strong> ${cap} · Min to run: ${min}</div>
          <div class="bar"><span style="width:0%"></span></div>
        `;
      });

      // interest submit
      const form = el.querySelector(`#form-${col}-${id}`);
      const ok   = el.querySelector(`#ok-${col}-${id}`);
      const er   = el.querySelector(`#er-${col}-${id}`);
      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        ok.style.display="none"; er.style.display="none";
        const fd = new FormData(form);
        const email = (fd.get("email")+"").trim();
        if (!email){ er.style.display="block"; return; }
        try{
          await addDoc(collection(db, col, id, "interests"), {
            name:(fd.get("name")+"").trim(),
            email,
            phone:(fd.get("phone")+"").trim(),
            seats:Number(fd.get("seats")||1),
            createdAt: serverTimestamp()
          });
          form.reset();
          ok.style.display="block";
        }catch(err){
          console.error(err);
          er.style.display="block";
        }
      });

      return el;
    }

    // lists
    async function renderList(col, mountId){
      const mount = document.getElementById(mountId);
      mount.innerHTML = `<span class="empty">Loading…</span>`;
      try{
        const qy = query(collection(db, col), orderBy("date","asc"));
        const snap = await getDocs(qy);
        const items = [];
        snap.forEach(d=> items.push({ id:d.id, data:d.data() }));

        const open = items.filter(x=>!isClosed(x.data.date, x.data.cutoff) && !x.data.closed);
        const closed = items.filter(x=> isClosed(x.data.date, x.data.cutoff) || x.data.closed);
        mount.innerHTML = "";
        [...open,...closed].forEach(({id,data})=> mount.appendChild(card(col,id,data)));
        if (!items.length) mount.innerHTML = `<span class="empty">No ${col} yet.</span>`;
      }catch(e){ console.error(e); mount.innerHTML = `<span class="empty">Could not load ${col}.</span>`; }
    }
    renderList("tours","toursList");
    renderList("events","eventsList");

    // Admin gate
    async function openIfAllowed(user){
      const email = (user && user.email) ? user.email : "";
      if (["info@tourthelakes.com"].includes(email)){
        window.open("admin.html","_blank","noopener");
      } else if (user){
        authMsg.textContent = "Not authorised";
        setTimeout(()=>authMsg.textContent="", 3000);
        await signOut(auth);
      }
    }

    // Admin sign-in
    async function doSignIn(){
      if (auth.currentUser) return openIfAllowed(auth.currentUser);
      try{
        const res = await signInWithPopup(auth, provider);
        await openIfAllowed(res.user);
      }catch(err){
        if (err && (err.code==='auth/operation-not-supported-in-this-environment' || err.code==='auth/popup-blocked')){
          await signInWithRedirect(auth, provider);
        }else{
          console.error(err);
          authMsg.textContent = "Sign in failed";
          setTimeout(()=>authMsg.textContent="", 3000);
        }
      }
    }

    document.getElementById("signinDot").addEventListener("click", doSignIn);

    getRedirectResult(auth)
      .then(res => { if (res && res.user) return openIfAllowed(res.user); })
      .catch(err => console.error(err));
  </script>

  <script>
    var yr = document.getElementById('yr');
    if (yr) { yr.textContent = new Date().getFullYear(); }
  </script>
</body>
</html>
