<!DOCTYPE html>  <html lang="en-GB">
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" />  
  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" />  
  <link rel="shortcut icon" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" type="image/png" />  
  <link rel="mask-icon" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" color="#d8a04e" />
  
  <title>Admin â€” Tour The Lakes</title> 
  
  <meta name="description" content="Authorised administrator panel for Tour The Lakes." />  
  <meta name="robots" content="noindex, nofollow" />  
  <meta name="theme-color" content="#0e1416" />  
  <meta name="color-scheme" content="dark light" />
  <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Work+Sans:wght@300;400;500&display=swap" rel="stylesheet" />


  
  </head>
<body>
  <!-- ===== HEADER ===== -->
  <header>
    <div class="brand">Tour The Lakes</div>
    <nav class="admin-status">
      <span id="userEmail">You're logged on as ...</span>
      <a href="#dates" class="admin-link">Dates</a>
      <button id="logoutBtn" class="logout-btn">Log Off</button>
    </nav>
  </header>

  <!-- ===== HERO ===== -->
  <section class="hero">
    <h1>Admin Panel</h1>
    <p>Authorised access confirmed.</p>
  </section>

  <!-- ===== AVAILABILITY ===== -->
  <section id="dates">
    <h2>Availability</h2>
    <div class="availability-wrap">
      <!-- Calendar Column -->
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="prevMonth" class="nav-arrow">â€¹</button>
          <div id="monthYear" class="month-year"></div>
          <button id="nextMonth" class="nav-arrow">â€º</button>
        </div>
        <div class="calendar-grid">
          <div class="calendar-days">
            <div>S</div><div>M</div><div>T</div><div>W</div>
            <div>T</div><div>F</div><div>S</div>
          </div>
          <div class="calendar-dates" id="calendarGrid"></div>
        </div>
      </div>

      <!-- Control Room Column -->
      <div class="control-room">
        <h3>Control Room</h3>
        <p id="selectedTourDisplay">No tour selected.</p>
        <p id="selectedDateDisplay">Select a date from the calendar to view details.</p>
        <div id="dateInfo"></div>
        <a href="#" id="saveChanges" class="save-link">Save Changes</a>
      </div>
    </div>
  </section>

  <!-- ===== ADMIN TABS ===== -->
  <section id="admin-tabs">
    <div class="tab-container">

      <!-- LEFT TAB â†’ Tour Selector -->
      <div class="tab">
        <div class="tour-selector">
          <a href="#" class="tour-link" data-tour="sls">Six Lakes Splendour</a>
          <a href="#" class="tour-link" data-tour="bp">Beatrix Potter</a>
          <a href="#" class="tour-link" data-tour="ws">Wordsworthâ€™s Lakeland</a>
        </div>
      </div>

      <!-- MIDDLE TAB â†’ Amendments Form -->
      <div class="tab">
        <form id="amendForm">
          <p id="noDataMsg">Select a tour and date to view or edit details.</p>
          <div id="amendFields" style="display:none;">
            <p><strong>Tour:</strong> <span id="formTour"></span></p>
            <p><strong>Date:</strong> <span id="formDate"></span></p>

            <label for="startTime">Tour Starting Time:</label><br>
            <input type="text" id="startTime" name="startTime" placeholder="e,g. 09:00 AM"><br><br>

            <label for="capacity">Tour Capacity:</label><br>
            <input type="text" id="capacity" name="capacity" placeholder="e,g. 12"><br><br>

            <label for="price">Price (Â£):</label><br>
            <input type="text" id="price" name="price" placeholder="e,g. 65.00"><br><br>
          </div>
        </form>
      </div>

      <!-- RIGHT TAB â†’ Seat Arrangement -->
      <div class="tab">
        <h3>Seating Arrangement</h3>
  <div class="seat-grid" id="seatGrid">
  <!-- Row 1: two right seats -->
  <div class="seat empty"></div>
  <div class="seat empty"></div>
  <div class="seat" data-seat="R1R1"></div>
  <div class="seat" data-seat="R1R2"></div>

  <!-- Row 2: left seat, blank, two right seats -->
  <div class="seat" data-seat="R2L1"></div>
  <div class="seat empty"></div>
  <div class="seat" data-seat="R2R1"></div>
  <div class="seat" data-seat="R2R2"></div>

  <!-- Row 3: same as row 2 -->
  <div class="seat" data-seat="R3L1"></div>
  <div class="seat empty"></div>
  <div class="seat" data-seat="R3R1"></div>
  <div class="seat" data-seat="R3R2"></div>

  <!-- Row 4: all four seats valid -->
  <div class="seat" data-seat="B1"></div>
  <div class="seat" data-seat="B2"></div>
  <div class="seat" data-seat="B3"></div>
  <div class="seat" data-seat="B4"></div>
           </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer>
    Â© <span id="year"></span> Tour The Lakes â€” Designed by
    <a href="https://www.neonforge.co.uk" target="_blank">Neon Forge</a>
  </footer>
</body>

<!-- ===== FIREBASE + MAIN LOGIC ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* ---------- Firebase Setup ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
  authDomain: "tourthelakes-1e165.firebaseapp.com",
  databaseURL: "https://tourthelakes-1e165-default-rtdb.firebaseio.com",
  projectId: "tourthelakes-1e165",
  storageBucket: "tourthelakes-1e165.firebasestorage.app",
  messagingSenderId: "470758171431",
  appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
  measurementId: "G-W6JY1LZXTP"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ---------- Auth Control ---------- */
const userEmail = document.getElementById("userEmail");
const logoutBtn = document.getElementById("logoutBtn");

onAuthStateChanged(auth, (user) => {
  if (user && user.email === "info@tourthelakes.com") {
    userEmail.textContent = `You're logged on as ${user.email}`;
  } else {
    window.location.href = "admin.html";
  }
});
logoutBtn.addEventListener("click", async () => {
  await signOut(auth);
  localStorage.clear();
  sessionStorage.clear();
  window.location.href = "admin.html";
});
document.getElementById("year").textContent = new Date().getFullYear();

/* ---------- Calendar + Data Logic ---------- */
const calendarGrid = document.getElementById("calendarGrid");
const monthYear = document.getElementById("monthYear");
const prevBtn = document.getElementById("prevMonth");
const nextBtn = document.getElementById("nextMonth");
const selectedDateDisplay = document.getElementById("selectedDateDisplay");
const dateInfo = document.getElementById("dateInfo");
const saveLink = document.getElementById("saveChanges");
const amendForm = document.getElementById("amendForm");
const amendFields = document.getElementById("amendFields");
const noDataMsg = document.getElementById("noDataMsg");
const formTour = document.getElementById("formTour");
const formDate = document.getElementById("formDate");
const seatGrid = document.getElementById("seatGrid");

let currentDate = new Date();
let activeTour = null;
let activeData = {};
let selectedDate = null;

/* Format date key */
function formatDate(y, m, d) {
  return `${y}-${String(m + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
}

/* Render Calendar */
function renderCalendar(date) {
  calendarGrid.innerHTML = "";
  const year = date.getFullYear();
  const month = date.getMonth();
  const monthNames = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];
  monthYear.textContent = `${monthNames[month]} ${year}`;

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) calendarGrid.appendChild(document.createElement("div"));
  for (let d = 1; d <= daysInMonth; d++) {
    const div = document.createElement("div");
    const key = formatDate(year, month, d);
    if (activeData[key]) div.classList.add("existing");
    div.textContent = d;
    div.addEventListener("click", () => handleDateClick(key, div));
    calendarGrid.appendChild(div);
  }
}

/* Handle Date Click */
async function handleDateClick(dateKey, element) {
  selectedDate = dateKey;
  document.querySelectorAll(".calendar-dates div").forEach(d => d.classList.remove("selected"));
  element.classList.add("selected");

  selectedDateDisplay.textContent = `Selected Date: ${dateKey}`;
  dateInfo.textContent = "Loading information...";

  if (!activeTour) {
    dateInfo.textContent = "Select a tour from Admin Tabs first.";
    return;
  }

  const snapshot = await get(ref(db, `availability/${activeTour}/${dateKey}`));
  const data = snapshot.val();

  if (data) {
    dateInfo.innerHTML = `
      <p><strong>Tour:</strong> ${activeTour.toUpperCase()}</p>
      <p><strong>Start Time:</strong> ${data.startTime || "â€”"}</p>
      <p><strong>Capacity:</strong> ${data.capacity || "â€”"}</p>
      <p><strong>Price:</strong> Â£${data.price || "â€”"}</p>
    `;
    populateAmendFields(activeTour, dateKey, data);
    updateSeatGrid(data.seats || {});
  } else {
    dateInfo.textContent = "Nothing is planned for this date.";
    resetAmendFields(activeTour, dateKey);
    clearSeatGrid();
  }
}

/* Populate Amend Form */
function populateAmendFields(tour, date, data) {
  noDataMsg.style.display = "none";
  amendFields.style.display = "block";
  formTour.textContent = tour.toUpperCase();
  formDate.textContent = date;
  document.getElementById("startTime").value = data.startTime || "";
  document.getElementById("capacity").value = data.capacity || "";
  document.getElementById("price").value = data.price || "";
}

/* Reset Amend Form */
function resetAmendFields(tour, date) {
  noDataMsg.style.display = "none";
  amendFields.style.display = "block";
  formTour.textContent = tour.toUpperCase();
  formDate.textContent = date;
  document.getElementById("startTime").value = "";
  document.getElementById("capacity").value = "";
  document.getElementById("price").value = "";
}

/* Save New Availability */
saveLink.addEventListener("click", async (e) => {
  e.preventDefault();
  if (!activeTour || !selectedDate) return alert("Select a tour and date first.");

  const payload = {
    startTime: document.getElementById("startTime").value || null,
    capacity: document.getElementById("capacity").value || null,
    price: document.getElementById("price").value || null,
  };
  await update(ref(db, `availability/${activeTour}/${selectedDate}`), payload);

  alert(`Saved ${activeTour.toUpperCase()} â€” ${selectedDate}`);
});

/* Load Tour Data */
function loadTourData(tour) {
  activeTour = tour;
  const tourRef = ref(db, `availability/${tour}`);
  onValue(tourRef, (snapshot) => {
    activeData = snapshot.val() || {};
    renderCalendar(currentDate);
  });
}

/* Tour Selector Events */
document.querySelectorAll(".tour-link").forEach((link) => {
  link.addEventListener("click", (e) => {
    e.preventDefault();
    document.querySelectorAll(".tour-link").forEach((l) => l.classList.remove("active"));
    link.classList.add("active");
    loadTourData(link.dataset.tour);

    // Update Control Room display
    const tourName = link.textContent.trim();
    document.getElementById("selectedTourDisplay").textContent = `Selected Tour: ${tourName}`;
    document.getElementById("dateInfo").textContent = "Select a date to view or edit details.";
    document.getElementById("selectedDateDisplay").textContent = "";
    selectedDate = null;

    // ðŸ§¹ Reset Amend Form when changing tours
    noDataMsg.style.display = "block";
    amendFields.style.display = "none";
    formTour.textContent = "";
    formDate.textContent = "";
    document.getElementById("startTime").value = "";
    document.getElementById("capacity").value = "";
    document.getElementById("price").value = "";
  });
});

/* Calendar Navigation */
prevBtn.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar(currentDate);
});
nextBtn.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar(currentDate);
});

/* ---------- Seating Logic ---------- */
function updateSeatGrid(seatData) {
  const seats = seatGrid.querySelectorAll(".seat");
  seats.forEach(seat => {
    const key = seat.dataset.seat;
    seat.classList.remove("booked");
    if (seatData[key] === "booked") seat.classList.add("booked");
  });
}
function clearSeatGrid() {
  seatGrid.querySelectorAll(".seat").forEach(seat => seat.classList.remove("booked"));
}

/* Initial Render */
renderCalendar(currentDate);
  </script>    
</html>
