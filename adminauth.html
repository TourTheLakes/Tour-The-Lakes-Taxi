<!DOCTYPE html>  <html lang="en-GB">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" />  
  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" />  
  <link rel="shortcut icon" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" type="image/png" />  
  <link rel="mask-icon" href="https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/TTL-Favicon.png" color="#d8a04e" />
  
  <title>Admin — Tour The Lakes</title> 
  
  <meta name="description" content="Authorised administrator panel for Tour The Lakes." />  
  <meta name="robots" content="noindex, nofollow" />  
  <meta name="theme-color" content="#0e1416" />  
  <meta name="color-scheme" content="dark light" />
  <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Work+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
<style>
  :root {
  --bg: #0e1416;
  --surface: #1a2023;
  --text: #e8e5df;
  --muted: #a5aaa9;
  --gold: #d8a04e;
  --tarn: #4b8ca7;
  --shadow: rgba(0, 0, 0, 0.5);
  --radius: 16px;
  --transition: 0.5s ease;
  --seat-size: 36px;
}

/* ========== GENERAL RESET / BASICS ========== */
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; scroll-behavior: smooth; }
body {
  font-family: "Work Sans", sans-serif;
  color: var(--text);
  background: var(--bg);
  overflow-x: hidden;
}

/* ========== HEADER ========== */
header {
  position: fixed;
  top: 0; left: 0; width: 100%;
  background: rgba(14, 20, 22, 0.6);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255,255,255,0.05);
  height: 80px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 60px;
  z-index: 100;
}
.brand {
  font-family: "Playfair Display", serif;
  font-size: 1.8rem;
  color: var(--gold);
  letter-spacing: 1px;
  text-decoration: none;
  transition: color var(--transition);
}
.brand:hover { color: var(--tarn); }
nav a {
  margin-left: 28px;
  text-decoration: none;
  color: var(--muted);
  transition: color var(--transition);
}
nav a:hover { color: var(--gold); }

.admin-status {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 28px;
  color: var(--muted);
  font-size: 1rem;
}
.admin-status a,
.admin-status button {
  text-decoration: none;
  color: var(--muted);
  background: none;
  border: none;
  font-family: inherit;
  font-size: 1rem;
  cursor: pointer;
  transition: color var(--transition);
}
.admin-status a:hover,
.admin-status button:hover { color: var(--gold); }

/* ========== HERO ========== */
.hero {
  min-height: 100vh;
  background: linear-gradient(rgba(14,14,14,0.4), rgba(14,14,14,0.8)),
    url('https://raw.githubusercontent.com/TourTheLakes/Tour-The-Lakes-Taxi/main/assets/images/DSC_0092.JPG')
    center/cover no-repeat;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: var(--text);
}
.hero h1 {
  font-family: "Playfair Display", serif;
  font-size: clamp(2.8rem, 6vw, 5rem);
  font-weight: 700;
  letter-spacing: 1px;
  color: var(--gold);
  text-shadow: 0 2px 20px var(--shadow);
  animation: fadeUp 1.5s ease forwards;
}
.hero p {
  font-size: 1.2rem;
  margin-top: 18px;
  max-width: 640px;
  color: var(--muted);
  animation: fadeUp 2s ease forwards;
}

/* ========== SECTION HEADINGS ========== */
section { padding: 100px 10vw; }
section h2 {
  font-family: "Playfair Display", serif;
  font-size: 2.2rem;
  color: var(--gold);
  margin-bottom: 16px;
  text-align: center;
}
section p {
  font-size: 1.1rem;
  color: var(--muted);
  max-width: 700px;
  line-height: 1.6;
}

/* ========== AVAILABILITY SPLIT LAYOUT ========== */
.availability-wrap {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 60px;
  flex-wrap: nowrap;
}
.calendar-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}
.control-room {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
  gap: 20px;
  background: none;
  padding: 0;
  min-height: 480px;
}
.control-room h3 {
  font-family: "Playfair Display", serif;
  color: var(--gold);
  font-size: 1.4rem;
  margin-bottom: 10px;
}
.control-room p { color: var(--muted); line-height: 1.5; }

/* ========== CALENDAR STYLES (existing, kept) ========== */
.calendar-header {
  display: flex;
  align-items: center;
  gap: 24px;
  margin-bottom: 24px;
}
.month-year {
  font-family: "Playfair Display", serif;
  font-size: 1.6rem;
  color: var(--gold);
  user-select: none;
}
.calendar-grid { width: 540px; }
.calendar-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
  grid-auto-rows: 32px;
  text-align: center;
  font-size: 1rem;
  color: var(--gold);
  margin-bottom: 10px;
}
.calendar-dates {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
  grid-auto-rows: 32px;
  align-content: start;
  justify-items: center;
  font-size: 1rem;
  width: 540px;
}
.calendar-dates div {
  padding: 8px 0;
  font-size: 1rem;
  color: var(--text);
  user-select: none;
  text-align: center;
  font-weight: 500;
  letter-spacing: 0.5px;
  border-radius: 6px;
  transition: background var(--transition), color var(--transition);
}
.calendar-dates div:hover {
  color: var(--gold);
  text-shadow: 0 0 10px rgba(216,160,78,0.3);
  cursor: pointer;
}
.calendar-dates div.existing {
  background: linear-gradient(90deg, var(--gold) 50%, var(--tarn) 50%);
  color: #fff;
}
.calendar-dates div.selected {
  background: none;
  color: var(--gold);
  text-shadow: 0 0 10px rgba(216,160,78,0.3);
}

/* ========== ADMIN TABS ========== */
#admin-tabs { padding: 100px 10vw; text-align: center; }
#admin-tabs h2 {
  font-family: "Playfair Display", serif;
  font-size: 2.2rem;
  color: var(--gold);
  margin-bottom: 40px;
}
.tab-container {
  display: flex;
  justify-content: space-between;
  align-items: stretch;
  width: 100%;
}
.tab {
  flex: 1;
  min-height: 380px;
  padding: 30px;
}
.tab:nth-child(1) { text-align: left; }
.tab:nth-child(2) { text-align: center; }
.tab:nth-child(3) { text-align: right; }

/* ========== SEATING GRID ========== */
.seat-grid {
  display: grid;
  grid-template-columns: repeat(4, var(--seat-size));
  grid-auto-rows: var(--seat-size);
  justify-content: center;
  gap: 14px 24px;
  margin-top: 30px;
}
.seat {
  width: var(--seat-size);
  height: var(--seat-size);
  border-radius: 6px;
  background: #155f1e; /* available default */
  box-shadow: 0 0 6px rgba(0,0,0,0.4) inset;
  pointer-events: none;
  cursor: default;
}

.seat.booked { background: #8b1a1a; }
.seat:hover { filter: brightness(1.2); }

/* seat positioning (entrance left, driver right) */
.row-empty { grid-column: 1; visibility: hidden; }
.row1-right { grid-column: 3 / span 2; }
.row2-left { grid-column: 1; }
.row2-right { grid-column: 3 / span 2; }
.row3-left { grid-column: 1; }
.row3-right { grid-column: 3 / span 2; }
.back-row { grid-column: 1 / span 4; display: flex; justify-content: space-between; }

/* ========== SAVE LINK INSIDE CONTROL ROOM ========== */
.save-link {
  display: inline-block;
  margin-top: 10px;
  font-size: 1rem;
  text-decoration: none;
  color: var(--gold);
  cursor: pointer;
  transition: opacity var(--transition);
}
.save-link:hover { opacity: 0.7; }

/* ========== FOOTER ========== */
footer {
  background: #0b0f10;
  text-align: center;
  padding: 30px;
  border-top: 1px solid rgba(255,255,255,0.1);
  font-size: 0.9rem;
  color: var(--muted);
}
footer a { color: var(--gold); text-decoration: none; }
footer a:hover { text-decoration: underline; }

/* ========== RESPONSIVE ========== */
@media (max-width: 700px) {
  .availability-wrap { flex-direction: column; gap: 40px; }
  .calendar-grid, .calendar-days, .calendar-dates {
    max-width: 360px;
  }
  .tab-container { flex-direction: column; }
  .tab { text-align: center; border-bottom: 1px solid var(--gold); }
  .tab:last-child { border-bottom: none; }
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
  </head>
<body>
  <!-- ===== HEADER ===== -->
  <header>
    <div class="brand">Tour The Lakes</div>
    <nav class="admin-status">
      <span id="userEmail">You're logged on as ...</span>
      <a href="#dates" class="admin-link">Dates</a>
      <button id="logoutBtn" class="logout-btn">Log Off</button>
    </nav>
  </header>

  <!-- ===== HERO ===== -->
  <section class="hero">
    <h1>Admin Panel</h1>
    <p>Authorised access confirmed.</p>
  </section>

  <!-- ===== AVAILABILITY ===== -->
  <section id="dates">
    <h2>Availability</h2>
    <div class="availability-wrap">
      <!-- Calendar Column -->
      <div class="calendar-container">
        <div class="calendar-header">
          <button id="prevMonth" class="nav-arrow">‹</button>
          <div id="monthYear" class="month-year"></div>
          <button id="nextMonth" class="nav-arrow">›</button>
        </div>
        <div class="calendar-grid">
          <div class="calendar-days">
            <div>S</div><div>M</div><div>T</div><div>W</div>
            <div>T</div><div>F</div><div>S</div>
          </div>
          <div class="calendar-dates" id="calendarGrid"></div>
        </div>
      </div>

      <!-- Control Room Column -->
      <div class="control-room">
        <h3>Control Room</h3>
        <p id="selectedTourDisplay">No tour selected.</p>
        <p id="selectedDateDisplay">Select a date from the calendar to view details.</p>
        <div id="dateInfo"></div>
        <a href="#" id="saveChanges" class="save-link">Save Changes</a>
      </div>
    </div>
  </section>

  <!-- ===== ADMIN TABS ===== -->
  <section id="admin-tabs">
    <h2>Admin Tabs</h2>
    <div class="tab-container">

      <!-- LEFT TAB → Tour Selector -->
      <div class="tab">
        <div class="tour-selector">
          <a href="#" class="tour-link" data-tour="sls">Six Lakes Splendour</a>
          <a href="#" class="tour-link" data-tour="bp">Beatrix Potter</a>
          <a href="#" class="tour-link" data-tour="ws">Wordsworth’s Lakeland</a>
        </div>
      </div>

      <!-- MIDDLE TAB → Amendments Form -->
      <div class="tab">
        <form id="amendForm">
          <p id="noDataMsg">Select a tour and date to view or edit details.</p>
          <div id="amendFields" style="display:none;">
            <p><strong>Tour:</strong> <span id="formTour"></span></p>
            <p><strong>Date:</strong> <span id="formDate"></span></p>

            <label for="startTime">Tour Starting Time:</label><br>
            <input type="time" id="startTime" name="startTime"><br><br>

            <label for="capacity">Tour Capacity:</label><br>
            <input type="number" id="capacity" name="capacity" min="1" max="16"><br><br>

            <label for="price">Price (£):</label><br>
            <input type="number" id="price" name="price" step="0.01"><br><br>
          </div>
        </form>
      </div>

      <!-- RIGHT TAB → Seat Arrangement -->
      <div class="tab">
        <h3>Seating Arrangement</h3>
        <div class="seat-grid" id="seatGrid">
          <!-- row 1 (right side only – driver side) -->
          <div class="row-empty"></div>
          <div class="seat row1-right" data-seat="R1R1"></div>
          <div class="seat" data-seat="R1R2"></div>

          <!-- row 2 (single left + double right) -->
          <div class="seat row2-left" data-seat="R2L1"></div>
          <div class="seat row2-right" data-seat="R2R1"></div>
          <div class="seat" data-seat="R2R2"></div>

          <!-- row 3 (single left + double right) -->
          <div class="seat row3-left" data-seat="R3L1"></div>
          <div class="seat row3-right" data-seat="R3R1"></div>
          <div class="seat" data-seat="R3R2"></div>

          <!-- back row (4 seats across) -->
          <div class="back-row">
            <div class="seat" data-seat="B1"></div>
            <div class="seat" data-seat="B2"></div>
            <div class="seat" data-seat="B3"></div>
            <div class="seat" data-seat="B4"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer>
    © <span id="year"></span> Tour The Lakes — Designed by
    <a href="https://www.neonforge.co.uk" target="_blank">Neon Forge</a>
  </footer>
</body>

<!-- ===== FIREBASE + MAIN LOGIC ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* ---------- Firebase Setup ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
  authDomain: "tourthelakes-1e165.firebaseapp.com",
  databaseURL: "https://tourthelakes-1e165-default-rtdb.firebaseio.com",
  projectId: "tourthelakes-1e165",
  storageBucket: "tourthelakes-1e165.firebasestorage.app",
  messagingSenderId: "470758171431",
  appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
  measurementId: "G-W6JY1LZXTP"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ---------- Auth Control ---------- */
const userEmail = document.getElementById("userEmail");
const logoutBtn = document.getElementById("logoutBtn");

onAuthStateChanged(auth, (user) => {
  if (user && user.email === "info@tourthelakes.com") {
    userEmail.textContent = `You're logged on as ${user.email}`;
  } else {
    window.location.href = "admin.html";
  }
});
logoutBtn.addEventListener("click", async () => {
  await signOut(auth);
  localStorage.clear();
  sessionStorage.clear();
  window.location.href = "admin.html";
});
document.getElementById("year").textContent = new Date().getFullYear();

/* ---------- Calendar + Data Logic ---------- */
const calendarGrid = document.getElementById("calendarGrid");
const monthYear = document.getElementById("monthYear");
const prevBtn = document.getElementById("prevMonth");
const nextBtn = document.getElementById("nextMonth");
const selectedDateDisplay = document.getElementById("selectedDateDisplay");
const dateInfo = document.getElementById("dateInfo");
const saveLink = document.getElementById("saveChanges");
const amendForm = document.getElementById("amendForm");
const amendFields = document.getElementById("amendFields");
const noDataMsg = document.getElementById("noDataMsg");
const formTour = document.getElementById("formTour");
const formDate = document.getElementById("formDate");
const seatGrid = document.getElementById("seatGrid");

let currentDate = new Date();
let activeTour = null;
let activeData = {};
let selectedDate = null;

/* Format date key */
function formatDate(y, m, d) {
  return `${y}-${String(m + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
}

/* Render Calendar */
function renderCalendar(date) {
  calendarGrid.innerHTML = "";
  const year = date.getFullYear();
  const month = date.getMonth();
  const monthNames = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];
  monthYear.textContent = `${monthNames[month]} ${year}`;

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) calendarGrid.appendChild(document.createElement("div"));
  for (let d = 1; d <= daysInMonth; d++) {
    const div = document.createElement("div");
    const key = formatDate(year, month, d);
    if (activeData[key]) div.classList.add("existing");
    div.textContent = d;
    div.addEventListener("click", () => handleDateClick(key, div));
    calendarGrid.appendChild(div);
  }
}

/* Handle Date Click */
async function handleDateClick(dateKey, element) {
  selectedDate = dateKey;
  document.querySelectorAll(".calendar-dates div").forEach(d => d.classList.remove("selected"));
  element.classList.add("selected");

  selectedDateDisplay.textContent = `Selected Date: ${dateKey}`;
  dateInfo.textContent = "Loading information...";

  if (!activeTour) {
    dateInfo.textContent = "Select a tour from Admin Tabs first.";
    return;
  }

  const snapshot = await get(ref(db, `availability/${activeTour}/${dateKey}`));
  const data = snapshot.val();

  if (data) {
    dateInfo.innerHTML = `
      <p><strong>Tour:</strong> ${activeTour.toUpperCase()}</p>
      <p><strong>Start Time:</strong> ${data.startTime || "—"}</p>
      <p><strong>Capacity:</strong> ${data.capacity || "—"}</p>
      <p><strong>Price:</strong> £${data.price || "—"}</p>
    `;
    populateAmendFields(activeTour, dateKey, data);
    updateSeatGrid(data.seats || {});
  } else {
    dateInfo.textContent = "Nothing is planned for this date.";
    resetAmendFields(activeTour, dateKey);
    clearSeatGrid();
  }
}

/* Populate Amend Form */
function populateAmendFields(tour, date, data) {
  noDataMsg.style.display = "none";
  amendFields.style.display = "block";
  formTour.textContent = tour.toUpperCase();
  formDate.textContent = date;
  document.getElementById("startTime").value = data.startTime || "";
  document.getElementById("capacity").value = data.capacity || "";
  document.getElementById("price").value = data.price || "";
}

/* Reset Amend Form */
function resetAmendFields(tour, date) {
  noDataMsg.style.display = "none";
  amendFields.style.display = "block";
  formTour.textContent = tour.toUpperCase();
  formDate.textContent = date;
  document.getElementById("startTime").value = "";
  document.getElementById("capacity").value = "";
  document.getElementById("price").value = "";
}

/* Save New Availability */
saveLink.addEventListener("click", async (e) => {
  e.preventDefault();
  if (!activeTour || !selectedDate) return alert("Select a tour and date first.");

  const payload = {
    startTime: document.getElementById("startTime").value || null,
    capacity: document.getElementById("capacity").value || null,
    price: document.getElementById("price").value || null,
  };
  await update(ref(db, `availability/${activeTour}/${selectedDate}`), payload);

  alert(`Saved ${activeTour.toUpperCase()} — ${selectedDate}`);
});

/* Load Tour Data */
function loadTourData(tour) {
  activeTour = tour;
  const tourRef = ref(db, `availability/${tour}`);
  onValue(tourRef, (snapshot) => {
    activeData = snapshot.val() || {};
    renderCalendar(currentDate);
  });
}

/* Tour Selector Events */


/* Calendar Navigation */
prevBtn.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar(currentDate);
});
nextBtn.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar(currentDate);
});

/* ---------- Seating Logic ---------- */
function updateSeatGrid(seatData) {
  const seats = seatGrid.querySelectorAll(".seat");
  seats.forEach(seat => {
    const key = seat.dataset.seat;
    seat.classList.remove("booked");
    if (seatData[key] === "booked") seat.classList.add("booked");
  });
}
function clearSeatGrid() {
  seatGrid.querySelectorAll(".seat").forEach(seat => seat.classList.remove("booked"));
}

/* Initial Render */
renderCalendar(currentDate);
  </script>    
</html>
