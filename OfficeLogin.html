<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Office Login</title>
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA9EdglxWetAv81qe1GnwlMf7HbPccjXxQ",
      authDomain: "tourthelakes-1e165.firebaseapp.com",
      databaseURL: "https://tourthelakes-1e165-default-rtdb.firebaseio.com",
      projectId: "tourthelakes-1e165",
      storageBucket: "tourthelakes-1e165.appspot.com",
      messagingSenderId: "470758171431",
      appId: "1:470758171431:web:f06dd39b0f15b63b2bff02",
      measurementId: "G-W6JY1LZXTP"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    async function officeLogin(event) {
      event.preventDefault();

      const enteredName = document.getElementById('staffName').value.trim();
      const enteredPassword = document.getElementById('staffPassword').value.trim();

      if (!enteredName || !enteredPassword) {
        alert('Please fill in both fields.');
        return;
      }

      const staffRef = ref(database, `officeStaff/${enteredName}`);
      
      try {
        const snapshot = await get(staffRef);

        if (snapshot.exists()) {
          const staffData = snapshot.val();
          if (staffData.password === enteredPassword) {
            const sessionToken = Date.now();
            localStorage.setItem('staffName', staffData.name);
            localStorage.setItem('sessionToken', sessionToken);

            const sessionRef = ref(database, `officeSessions/${staffData.name}`);
            await set(sessionRef, {
              sessionToken: sessionToken
            }).catch((error) => {
              console.error('Failed to save session token:', error);
              alert('Login failed. Try again.');
              return;
            });

            window.location.href = 'Office.html';
          } else {
            alert('Incorrect password.');
          }
        } else {
          alert('Office staff not found.');
        }
      } catch (error) {
        console.error(error);
        alert('Login failed.');
      }
    }

    window.officeLogin = officeLogin;
  </script>
</head>
<body>
  <h1>Office Staff Login</h1>
  <form onsubmit="officeLogin(event)">
    <label for="staffName">Staff Name:</label><br>
    <input type="text" id="staffName" name="staffName" required><br><br>

    <label for="staffPassword">Password:</label><br>
    <input type="password" id="staffPassword" name="staffPassword" required><br><br>

    <button type="submit">Login</button>
  </form>
</body>
</html>
